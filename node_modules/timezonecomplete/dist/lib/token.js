/**
 * Copyright(c) 2014 Spirit IT BV
 *
 * Functionality to parse a DateTime object to a string
 */
"use strict";
var Tokenizer = (function () {
    /**
     * Create a new tokenizer
     * @param _formatString (optional) Set the format string
     */
    function Tokenizer(_formatString) {
        this._formatString = _formatString;
    }
    /**
     * Set the format string
     * @param formatString The new string to use for formatting
     */
    Tokenizer.prototype.setFormatString = function (formatString) {
        this._formatString = formatString;
    };
    /**
     * Append a new token to the current list of tokens.
     *
     * @param tokenString The string that makes up the token
     * @param tokenArray The existing array of tokens
     * @param raw (optional) If true, don't parse the token but insert it as is
     * @return Token[] The resulting array of tokens.
     */
    Tokenizer.prototype._appendToken = function (tokenString, tokenArray, raw) {
        if (tokenString !== "") {
            var token = {
                length: tokenString.length,
                raw: tokenString,
                symbol: tokenString[0],
                type: DateTimeTokenType.IDENTITY
            };
            if (!raw) {
                token.type = mapSymbolToType(token.symbol);
            }
            tokenArray.push(token);
        }
        return tokenArray;
    };
    /**
     * Parse the internal string and return an array of tokens.
     * @return Token[]
     */
    Tokenizer.prototype.parseTokens = function () {
        var result = [];
        var currentToken = "";
        var previousChar = "";
        var quoting = false;
        var possibleEscaping = false;
        for (var i = 0; i < this._formatString.length; ++i) {
            var currentChar = this._formatString[i];
            // Hanlde escaping and quoting
            if (currentChar === "'") {
                if (!quoting) {
                    if (possibleEscaping) {
                        // Escaped a single ' character without quoting
                        if (currentChar !== previousChar) {
                            result = this._appendToken(currentToken, result);
                            currentToken = "";
                        }
                        currentToken += "'";
                        possibleEscaping = false;
                    }
                    else {
                        possibleEscaping = true;
                    }
                }
                else {
                    // Two possibilities: Were are done quoting, or we are escaping a ' character
                    if (possibleEscaping) {
                        // Escaping, add ' to the token
                        currentToken += currentChar;
                        possibleEscaping = false;
                    }
                    else {
                        // Maybe escaping, wait for next token if we are escaping
                        possibleEscaping = true;
                    }
                }
                if (!possibleEscaping) {
                    // Current character is relevant, so save it for inspecting next round
                    previousChar = currentChar;
                }
                continue;
            }
            else if (possibleEscaping) {
                quoting = !quoting;
                possibleEscaping = false;
                // Flush current token
                result = this._appendToken(currentToken, result, !quoting);
                currentToken = "";
            }
            if (quoting) {
                // Quoting mode, add character to token.
                currentToken += currentChar;
                previousChar = currentChar;
                continue;
            }
            if (currentChar !== previousChar) {
                // We stumbled upon a new token!
                result = this._appendToken(currentToken, result);
                currentToken = currentChar;
            }
            else {
                // We are repeating the token with more characters
                currentToken += currentChar;
            }
            previousChar = currentChar;
        }
        // Don't forget to add the last token to the result!
        result = this._appendToken(currentToken, result, quoting);
        return result;
    };
    return Tokenizer;
}());
exports.Tokenizer = Tokenizer;
/**
 * Different types of tokens, each for a DateTime "period type" (like year, month, hour etc.)
 */
(function (DateTimeTokenType) {
    DateTimeTokenType[DateTimeTokenType["IDENTITY"] = 0] = "IDENTITY";
    DateTimeTokenType[DateTimeTokenType["ERA"] = 1] = "ERA";
    DateTimeTokenType[DateTimeTokenType["YEAR"] = 2] = "YEAR";
    DateTimeTokenType[DateTimeTokenType["QUARTER"] = 3] = "QUARTER";
    DateTimeTokenType[DateTimeTokenType["MONTH"] = 4] = "MONTH";
    DateTimeTokenType[DateTimeTokenType["WEEK"] = 5] = "WEEK";
    DateTimeTokenType[DateTimeTokenType["DAY"] = 6] = "DAY";
    DateTimeTokenType[DateTimeTokenType["WEEKDAY"] = 7] = "WEEKDAY";
    DateTimeTokenType[DateTimeTokenType["DAYPERIOD"] = 8] = "DAYPERIOD";
    DateTimeTokenType[DateTimeTokenType["HOUR"] = 9] = "HOUR";
    DateTimeTokenType[DateTimeTokenType["MINUTE"] = 10] = "MINUTE";
    DateTimeTokenType[DateTimeTokenType["SECOND"] = 11] = "SECOND";
    DateTimeTokenType[DateTimeTokenType["ZONE"] = 12] = "ZONE";
})(exports.DateTimeTokenType || (exports.DateTimeTokenType = {}));
var DateTimeTokenType = exports.DateTimeTokenType;
var symbolMapping = {
    "G": DateTimeTokenType.ERA,
    "y": DateTimeTokenType.YEAR,
    "Y": DateTimeTokenType.YEAR,
    "u": DateTimeTokenType.YEAR,
    "U": DateTimeTokenType.YEAR,
    "r": DateTimeTokenType.YEAR,
    "Q": DateTimeTokenType.QUARTER,
    "q": DateTimeTokenType.QUARTER,
    "M": DateTimeTokenType.MONTH,
    "L": DateTimeTokenType.MONTH,
    "l": DateTimeTokenType.MONTH,
    "w": DateTimeTokenType.WEEK,
    "W": DateTimeTokenType.WEEK,
    "d": DateTimeTokenType.DAY,
    "D": DateTimeTokenType.DAY,
    "F": DateTimeTokenType.DAY,
    "g": DateTimeTokenType.DAY,
    "E": DateTimeTokenType.WEEKDAY,
    "e": DateTimeTokenType.WEEKDAY,
    "c": DateTimeTokenType.WEEKDAY,
    "a": DateTimeTokenType.DAYPERIOD,
    "h": DateTimeTokenType.HOUR,
    "H": DateTimeTokenType.HOUR,
    "k": DateTimeTokenType.HOUR,
    "K": DateTimeTokenType.HOUR,
    "j": DateTimeTokenType.HOUR,
    "J": DateTimeTokenType.HOUR,
    "m": DateTimeTokenType.MINUTE,
    "s": DateTimeTokenType.SECOND,
    "S": DateTimeTokenType.SECOND,
    "A": DateTimeTokenType.SECOND,
    "z": DateTimeTokenType.ZONE,
    "Z": DateTimeTokenType.ZONE,
    "O": DateTimeTokenType.ZONE,
    "v": DateTimeTokenType.ZONE,
    "V": DateTimeTokenType.ZONE,
    "X": DateTimeTokenType.ZONE,
    "x": DateTimeTokenType.ZONE
};
/**
 * Map the given symbol to one of the DateTimeTokenTypes
 * If there is no mapping, DateTimeTokenType.IDENTITY is used
 *
 * @param symbol The single-character symbol used to map the token
 * @return DateTimeTokenType The Type of token this symbol represents
 */
function mapSymbolToType(symbol) {
    if (symbolMapping.hasOwnProperty(symbol)) {
        return symbolMapping[symbol];
    }
    else {
        return DateTimeTokenType.IDENTITY;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW4uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGliL3Rva2VuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxZQUFZLENBQUM7QUFFYjtJQUVDOzs7T0FHRztJQUNILG1CQUFvQixhQUFzQjtRQUF0QixrQkFBYSxHQUFiLGFBQWEsQ0FBUztJQUUxQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsbUNBQWUsR0FBZixVQUFnQixZQUFvQjtRQUNuQyxJQUFJLENBQUMsYUFBYSxHQUFHLFlBQVksQ0FBQztJQUNuQyxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNLLGdDQUFZLEdBQXBCLFVBQXFCLFdBQW1CLEVBQUUsVUFBbUIsRUFBRSxHQUFhO1FBQzNFLEVBQUUsQ0FBQyxDQUFDLFdBQVcsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLElBQU0sS0FBSyxHQUFVO2dCQUNwQixNQUFNLEVBQUUsV0FBVyxDQUFDLE1BQU07Z0JBQzFCLEdBQUcsRUFBRSxXQUFXO2dCQUNoQixNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLGlCQUFpQixDQUFDLFFBQVE7YUFDaEMsQ0FBQztZQUVGLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDVixLQUFLLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDNUMsQ0FBQztZQUNELFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEIsQ0FBQztRQUNELE1BQU0sQ0FBQyxVQUFVLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNILCtCQUFXLEdBQVg7UUFDQyxJQUFJLE1BQU0sR0FBWSxFQUFFLENBQUM7UUFFekIsSUFBSSxZQUFZLEdBQVcsRUFBRSxDQUFDO1FBQzlCLElBQUksWUFBWSxHQUFXLEVBQUUsQ0FBQztRQUM5QixJ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QUFHO0lBQzFCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxHQUFHO0lBQzFCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxHQUFHO0lBRTFCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxPQUFPO0lBQzlCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxPQUFPO0lBQzlCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxPQUFPO0lBRTlCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxTQUFTO0lBRWhDLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBRTNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxNQUFNO0lBRTdCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxNQUFNO0lBQzdCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxNQUFNO0lBQzdCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxNQUFNO0lBRTdCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0lBQzNCLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO0NBQzNCLENBQUM7QUFFRjs7Ozs7O0dBTUc7QUFDSCx5QkFBeUIsTUFBYztJQUN0QyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNQLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUM7SUFDbkMsQ0FBQztBQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0KGMpIDIwMTQgU3Bpcml0IElUIEJWXHJcbiAqXHJcbiAqIEZ1bmN0aW9uYWxpdHkgdG8gcGFyc2UgYSBEYXRlVGltZSBvYmplY3QgdG8gYSBzdHJpbmdcclxuICovXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBUb2tlbml6ZXIge1xyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGUgYSBuZXcgdG9rZW5pemVyXHJcblx0ICogQHBhcmFtIF9mb3JtYXRTdHJpbmcgKG9wdGlvbmFsKSBTZXQgdGhlIGZvcm1hdCBzdHJpbmdcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIF9mb3JtYXRTdHJpbmc/OiBzdHJpbmcpIHtcclxuXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBTZXQgdGhlIGZvcm1hdCBzdHJpbmdcclxuXHQgKiBAcGFyYW0gZm9ybWF0U3RyaW5nIFRoZSBuZXcgc3RyaW5nIHRvIHVzZSBmb3IgZm9ybWF0dGluZ1xyXG5cdCAqL1xyXG5cdHNldEZvcm1hdFN0cmluZyhmb3JtYXRTdHJpbmc6IHN0cmluZyk6IHZvaWQge1xyXG5cdFx0dGhpcy5fZm9ybWF0U3RyaW5nID0gZm9ybWF0U3RyaW5nO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQXBwZW5kIGEgbmV3IHRva2VuIHRvIHRoZSBjdXJyZW50IGxpc3Qgb2YgdG9rZW5zLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIHRva2VuU3RyaW5nIFRoZSBzdHJpbmcgdGhhdCBtYWtlcyB1cCB0aGUgdG9rZW5cclxuXHQgKiBAcGFyYW0gdG9rZW5BcnJheSBUaGUgZXhpc3RpbmcgYXJyYXkgb2YgdG9rZW5zXHJcblx0ICogQHBhcmFtIHJhdyAob3B0aW9uYWwpIElmIHRydWUsIGRvbid0IHBhcnNlIHRoZSB0b2tlbiBidXQgaW5zZXJ0IGl0IGFzIGlzXHJcblx0ICogQHJldHVybiBUb2tlbltdIFRoZSByZXN1bHRpbmcgYXJyYXkgb2YgdG9rZW5zLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgX2FwcGVuZFRva2VuKHRva2VuU3RyaW5nOiBzdHJpbmcsIHRva2VuQXJyYXk6IFRva2VuW10sIHJhdz86IGJvb2xlYW4pOiBUb2tlbltdIHtcclxuXHRcdGlmICh0b2tlblN0cmluZyAhPT0gXCJcIikge1xyXG5cdFx0XHRjb25zdCB0b2tlbjogVG9rZW4gPSB7XHJcblx0XHRcdFx0bGVuZ3RoOiB0b2tlblN0cmluZy5sZW5ndGgsXHJcblx0XHRcdFx0cmF3OiB0b2tlblN0cmluZyxcclxuXHRcdFx0XHRzeW1ib2w6IHRva2VuU3RyaW5nWzBdLFxyXG5cdFx0XHRcdHR5cGU6IERhdGVUaW1lVG9rZW5UeXBlLklERU5USVRZXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRpZiAoIXJhdykge1xyXG5cdFx0XHRcdHRva2VuLnR5cGUgPSBtYXBTeW1ib2xUb1R5cGUodG9rZW4uc3ltYm9sKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0b2tlbkFycmF5LnB1c2godG9rZW4pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRva2VuQXJyYXk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBQYXJzZSB0aGUgaW50ZXJuYWwgc3RyaW5nIGFuZCByZXR1cm4gYW4gYXJyYXkgb2YgdG9rZW5zLlxyXG5cdCAqIEByZXR1cm4gVG9rZW5bXVxyXG5cdCAqL1xyXG5cdHBhcnNlVG9rZW5zKCk6IFRva2VuW10ge1xyXG5cdFx0bGV0IHJlc3VsdDogVG9rZW5bXSA9IFtdO1xyXG5cclxuXHRcdGxldCBjdXJyZW50VG9rZW46IHN0cmluZyA9IFwiXCI7XHJcblx0XHRsZXQgcHJldmlvdXNDaGFyOiBzdHJpbmcgPSBcIlwiO1xyXG5cdFx0bGV0IHF1b3Rpbmc6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHRcdGxldCBwb3NzaWJsZUVzY2FwaW5nOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9mb3JtYXRTdHJpbmcubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0Y29uc3QgY3VycmVudENoYXIgPSB0aGlzLl9mb3JtYXRTdHJpbmdbaV07XHJcblxyXG5cdFx0XHQvLyBIYW5sZGUgZXNjYXBpbmcgYW5kIHF1b3RpbmdcclxuXHRcdFx0aWYgKGN1cnJlbnRDaGFyID09PSBcIidcIikge1xyXG5cdFx0XHRcdGlmICghcXVvdGluZykge1xyXG5cdFx0XHRcdFx0aWYgKHBvc3NpYmxlRXNjYXBpbmcpIHtcclxuXHRcdFx0XHRcdFx0Ly8gRXNjYXBlZCBhIHNpbmdsZSAnIGNoYXJhY3RlciB3aXRob3V0IHF1b3RpbmdcclxuXHRcdFx0XHRcdFx0aWYgKGN1cnJlbnRDaGFyICE9PSBwcmV2aW91c0NoYXIpIHtcclxuXHRcdFx0XHRcdFx0XHRyZXN1bHQgPSB0aGlzLl9hcHBlbmRUb2tlbihjdXJyZW50VG9rZW4sIHJlc3VsdCk7XHJcblx0XHRcdFx0XHRcdFx0Y3VycmVudFRva2VuID0gXCJcIjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRjdXJyZW50VG9rZW4gKz0gXCInXCI7XHJcblx0XHRcdFx0XHRcdHBvc3NpYmxlRXNjYXBpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHBvc3NpYmxlRXNjYXBpbmcgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHQvLyBUd28gcG9zc2liaWxpdGllczogV2VyZSBhcmUgZG9uZSBxdW90aW5nLCBvciB3ZSBhcmUgZXNjYXBpbmcgYSAnIGNoYXJhY3RlclxyXG5cdFx0XHRcdFx0aWYgKHBvc3NpYmxlRXNjYXBpbmcpIHtcclxuXHRcdFx0XHRcdFx0Ly8gRXNjYXBpbmcsIGFkZCAnIHRvIHRoZSB0b2tlblxyXG5cdFx0XHRcdFx0XHRjdXJyZW50VG9rZW4gKz0gY3VycmVudENoYXI7XHJcblx0XHRcdFx0XHRcdHBvc3NpYmxlRXNjYXBpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdC8vIE1heWJlIGVzY2FwaW5nLCB3YWl0IGZvciBuZXh0IHRva2VuIGlmIHdlIGFyZSBlc2NhcGluZ1xyXG5cdFx0XHRcdFx0XHRwb3NzaWJsZUVzY2FwaW5nID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICghcG9zc2libGVFc2NhcGluZykge1xyXG5cdFx0XHRcdFx0Ly8gQ3VycmVudCBjaGFyYWN0ZXIgaXMgcmVsZXZhbnQsIHNvIHNhdmUgaXQgZm9yIGluc3BlY3RpbmcgbmV4dCByb3VuZFxyXG5cdFx0XHRcdFx0cHJldmlvdXNDaGFyID0gY3VycmVudENoYXI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHBvc3NpYmxlRXNjYXBpbmcpIHtcclxuXHRcdFx0XHRxdW90aW5nID0gIXF1b3Rpbmc7XHJcblx0XHRcdFx0cG9zc2libGVFc2NhcGluZyA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHQvLyBGbHVzaCBjdXJyZW50IHRva2VuXHJcblx0XHRcdFx0cmVzdWx0ID0gdGhpcy5fYXBwZW5kVG9rZW4oY3VycmVudFRva2VuLCByZXN1bHQsICFxdW90aW5nKTtcclxuXHRcdFx0XHRjdXJyZW50VG9rZW4gPSBcIlwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAocXVvdGluZykge1xyXG5cdFx0XHRcdC8vIFF1b3RpbmcgbW9kZSwgYWRkIGNoYXJhY3RlciB0byB0b2tlbi5cclxuXHRcdFx0XHRjdXJyZW50VG9rZW4gKz0gY3VycmVudENoYXI7XHJcblx0XHRcdFx0cHJldmlvdXNDaGFyID0gY3VycmVudENoYXI7XHJcblx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChjdXJyZW50Q2hhciAhPT0gcHJldmlvdXNDaGFyKSB7XHJcblx0XHRcdFx0Ly8gV2Ugc3R1bWJsZWQgdXBvbiBhIG5ldyB0b2tlbiFcclxuXHRcdFx0XHRyZXN1bHQgPSB0aGlzLl9hcHBlbmRUb2tlbihjdXJyZW50VG9rZW4sIHJlc3VsdCk7XHJcblx0XHRcdFx0Y3VycmVudFRva2VuID0gY3VycmVudENoYXI7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gV2UgYXJlIHJlcGVhdGluZyB0aGUgdG9rZW4gd2l0aCBtb3JlIGNoYXJhY3RlcnNcclxuXHRcdFx0XHRjdXJyZW50VG9rZW4gKz0gY3VycmVudENoYXI7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHByZXZpb3VzQ2hhciA9IGN1cnJlbnRDaGFyO1xyXG5cdFx0fVxyXG5cdFx0Ly8gRG9uJ3QgZm9yZ2V0IHRvIGFkZCB0aGUgbGFzdCB0b2tlbiB0byB0aGUgcmVzdWx0IVxyXG5cdFx0cmVzdWx0ID0gdGhpcy5fYXBwZW5kVG9rZW4oY3VycmVudFRva2VuLCByZXN1bHQsIHF1b3RpbmcpO1xyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxufVxyXG5cclxuLyoqXHJcbiAqIERpZmZlcmVudCB0eXBlcyBvZiB0b2tlbnMsIGVhY2ggZm9yIGEgRGF0ZVRpbWUgXCJwZXJpb2QgdHlwZVwiIChsaWtlIHllYXIsIG1vbnRoLCBob3VyIGV0Yy4pXHJcbiAqL1xyXG5leHBvcnQgZW51bSBEYXRlVGltZVRva2VuVHlwZSB7XHJcblx0SURFTlRJVFksIC8vIFNwZWNpYWwsIGRvIG5vdCBcImZvcm1hdFwiIHRoaXMsIGJ1dCBqdXN0IG91dHB1dCB3aGF0IHdlbnQgaW5cclxuXHJcblx0RVJBLFxyXG5cdFlFQVIsXHJcblx0UVVBUlRFUixcclxuXHRNT05USCxcclxuXHRXRUVLLFxyXG5cdERBWSxcclxuXHRXRUVLREFZLFxyXG5cdERBWVBFUklPRCxcclxuXHRIT1VSLFxyXG5cdE1JTlVURSxcclxuXHRTRUNPTkQsXHJcblx0Wk9ORVxyXG59XHJcblxyXG4vKipcclxuICogQmFzaWMgdG9rZW5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVG9rZW4ge1xyXG5cdC8qKlxyXG5cdCAqIFRoZSB0eXBlIG9mIHRva2VuXHJcblx0ICovXHJcblx0dHlwZTogRGF0ZVRpbWVUb2tlblR5cGU7XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSBzeW1ib2wgZnJvbSB3aGljaCB0aGUgdG9rZW4gd2FzIHBhcnNlZFxyXG5cdCAqL1xyXG5cdHN5bWJvbDogc3RyaW5nO1xyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgdG90YWwgbGVuZ3RoIG9mIHRoZSB0b2tlblxyXG5cdCAqL1xyXG5cdGxlbmd0aDogbnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgb3JpZ2luYWwgc3RyaW5nIHRoYXQgcHJvZHVjZWQgdGhpcyB0b2tlblxyXG5cdCAqL1xyXG5cdHJhdzogc3RyaW5nO1xyXG59XHJcblxyXG5jb25zdCBzeW1ib2xNYXBwaW5nOiB7IFtjaGFyOiBzdHJpbmddOiBEYXRlVGltZVRva2VuVHlwZSB9ID0ge1xyXG5cdFwiR1wiOiBEYXRlVGltZVRva2VuVHlwZS5FUkEsXHJcblxyXG5cdFwieVwiOiBEYXRlVGltZVRva2VuVHlwZS5ZRUFSLFxyXG5cdFwiWVwiOiBEYXRlVGltZVRva2VuVHlwZS5ZRUFSLFxyXG5cdFwidVwiOiBEYXRlVGltZVRva2VuVHlwZS5ZRUFSLFxyXG5cdFwiVVwiOiBEYXRlVGltZVRva2VuVHlwZS5ZRUFSLFxyXG5cdFwiclwiOiBEYXRlVGltZVRva2VuVHlwZS5ZRUFSLFxyXG5cclxuXHRcIlFcIjogRGF0ZVRpbWVUb2tlblR5cGUuUVVBUlRFUixcclxuXHRcInFcIjogRGF0ZVRpbWVUb2tlblR5cGUuUVVBUlRFUixcclxuXHJcblx0XCJNXCI6IERhdGVUaW1lVG9rZW5UeXBlLk1PTlRILFxyXG5cdFwiTFwiOiBEYXRlVGltZVRva2VuVHlwZS5NT05USCxcclxuXHRcImxcIjogRGF0ZVRpbWVUb2tlblR5cGUuTU9OVEgsXHJcblxyXG5cdFwid1wiOiBEYXRlVGltZVRva2VuVHlwZS5XRUVLLFxyXG5cdFwiV1wiOiBEYXRlVGltZVRva2VuVHlwZS5XRUVLLFxyXG5cclxuXHRcImRcIjogRGF0ZVRpbWVUb2tlblR5cGUuREFZLFxyXG5cdFwiRFwiOiBEYXRlVGltZVRva2VuVHlwZS5EQVksXHJcblx0XCJGXCI6IERhdGVUaW1lVG9rZW5UeXBlLkRBWSxcclxuXHRcImdcIjogRGF0ZVRpbWVUb2tlblR5cGUuREFZLFxyXG5cclxuXHRcIkVcIjogRGF0ZVRpbWVUb2tlblR5cGUuV0VFS0RBWSxcclxuXHRcImVcIjogRGF0ZVRpbWVUb2tlblR5cGUuV0VFS0RBWSxcclxuXHRcImNcIjogRGF0ZVRpbWVUb2tlblR5cGUuV0VFS0RBWSxcclxuXHJcblx0XCJhXCI6IERhdGVUaW1lVG9rZW5UeXBlLkRBWVBFUklPRCxcclxuXHJcblx0XCJoXCI6IERhdGVUaW1lVG9rZW5UeXBlLkhPVVIsXHJcblx0XCJIXCI6IERhdGVUaW1lVG9rZW5UeXBlLkhPVVIsXHJcblx0XCJrXCI6IERhdGVUaW1lVG9rZW5UeXBlLkhPVVIsXHJcblx0XCJLXCI6IERhdGVUaW1lVG9rZW5UeXBlLkhPVVIsXHJcblx0XCJqXCI6IERhdGVUaW1lVG9rZW5UeXBlLkhPVVIsXHJcblx0XCJKXCI6IERhdGVUaW1lVG9rZW5UeXBlLkhPVVIsXHJcblxyXG5cdFwibVwiOiBEYXRlVGltZVRva2VuVHlwZS5NSU5VVEUsXHJcblxyXG5cdFwic1wiOiBEYXRlVGltZVRva2VuVHlwZS5TRUNPTkQsXHJcblx0XCJTXCI6IERhdGVUaW1lVG9rZW5UeXBlLlNFQ09ORCxcclxuXHRcIkFcIjogRGF0ZVRpbWVUb2tlblR5cGUuU0VDT05ELFxyXG5cclxuXHRcInpcIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORSxcclxuXHRcIlpcIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORSxcclxuXHRcIk9cIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORSxcclxuXHRcInZcIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORSxcclxuXHRcIlZcIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORSxcclxuXHRcIlhcIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORSxcclxuXHRcInhcIjogRGF0ZVRpbWVUb2tlblR5cGUuWk9ORVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIE1hcCB0aGUgZ2l2ZW4gc3ltYm9sIHRvIG9uZSBvZiB0aGUgRGF0ZVRpbWVUb2tlblR5cGVzXHJcbiAqIElmIHRoZXJlIGlzIG5vIG1hcHBpbmcsIERhdGVUaW1lVG9rZW5UeXBlLklERU5USVRZIGlzIHVzZWRcclxuICpcclxuICogQHBhcmFtIHN5bWJvbCBUaGUgc2luZ2xlLWNoYXJhY3RlciBzeW1ib2wgdXNlZCB0byBtYXAgdGhlIHRva2VuXHJcbiAqIEByZXR1cm4gRGF0ZVRpbWVUb2tlblR5cGUgVGhlIFR5cGUgb2YgdG9rZW4gdGhpcyBzeW1ib2wgcmVwcmVzZW50c1xyXG4gKi9cclxuZnVuY3Rpb24gbWFwU3ltYm9sVG9UeXBlKHN5bWJvbDogc3RyaW5nKTogRGF0ZVRpbWVUb2tlblR5cGUge1xyXG5cdGlmIChzeW1ib2xNYXBwaW5nLmhhc093blByb3BlcnR5KHN5bWJvbCkpIHtcclxuXHRcdHJldHVybiBzeW1ib2xNYXBwaW5nW3N5bWJvbF07XHJcblx0fSBlbHNlIHtcclxuXHRcdHJldHVybiBEYXRlVGltZVRva2VuVHlwZS5JREVOVElUWTtcclxuXHR9XHJcbn1cclxuIl19