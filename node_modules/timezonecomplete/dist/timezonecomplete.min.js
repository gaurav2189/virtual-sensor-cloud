!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.tc=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function assert(condition,message){if(!condition)throw new Error(message)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=assert},{}],2:[function(require,module,exports){"use strict";function timeUnitToMilliseconds(unit){switch(unit){case TimeUnit.Millisecond:return 1;case TimeUnit.Second:return 1e3;case TimeUnit.Minute:return 6e4;case TimeUnit.Hour:return 36e5;case TimeUnit.Day:return 864e5;case TimeUnit.Week:return 6048e5;case TimeUnit.Month:return 2592e6;case TimeUnit.Year:return 31104e6;default:throw new Error("Unknown time unit")}}function timeUnitToString(unit,amount){void 0===amount&&(amount=1);var result=TimeUnit[unit].toLowerCase();return 1===amount||amount===-1?result:result+"s"}function stringToTimeUnit(s){for(var trimmed=s.trim().toLowerCase(),i=0;i<TimeUnit.MAX;++i){var other=timeUnitToString(i,1);if(other===trimmed||other+"s"===trimmed)return i}throw new Error("Unknown time unit string '"+s+"'")}function isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0)}function daysInYear(year){return isLeapYear(year)?366:365}function daysInMonth(year,month){switch(month){case 1:case 3:case 5:case 7:case 8:case 10:case 12:return 31;case 2:return isLeapYear(year)?29:28;case 4:case 6:case 9:case 11:return 30;default:throw new Error("Invalid month: "+month)}}function dayOfYear(year,month,day){assert_1.default(month>=1&&month<=12,"Month out of range"),assert_1.default(day>=1&&day<=daysInMonth(year,month),"day out of range");for(var yearDay=0,i=1;i<month;i++)yearDay+=daysInMonth(year,i);return yearDay+=day-1}function lastWeekDayOfMonth(year,month,weekDay){var endOfMonth=new TimeStruct({year:year,month:month,day:daysInMonth(year,month)}),endOfMonthWeekDay=weekDayNoLeapSecs(endOfMonth.unixMillis),diff=weekDay-endOfMonthWeekDay;return diff>0&&(diff-=7),endOfMonth.components.day+diff}function firstWeekDayOfMonth(year,month,weekDay){var beginOfMonth=new TimeStruct({year:year,month:month,day:1}),beginOfMonthWeekDay=weekDayNoLeapSecs(beginOfMonth.unixMillis),diff=weekDay-beginOfMonthWeekDay;return diff<0&&(diff+=7),beginOfMonth.components.day+diff}function weekDayOnOrAfter(year,month,day,weekDay){var start=new TimeStruct({year:year,month:month,day:day}),startWeekDay=weekDayNoLeapSecs(start.unixMillis),diff=weekDay-startWeekDay;return diff<0&&(diff+=7),assert_1.default(start.components.day+diff<=daysInMonth(year,month),"The given month has no such weekday"),start.components.day+diff}function weekDayOnOrBefore(year,month,day,weekDay){var start=new TimeStruct({year:year,month:month,day:day}),startWeekDay=weekDayNoLeapSecs(start.unixMillis),diff=weekDay-startWeekDay;return diff>0&&(diff-=7),assert_1.default(start.components.day+diff>=1,"The given month has no such weekday"),start.components.day+diff}function weekOfMonth(year,month,day){var firstThursday=firstWeekDayOfMonth(year,month,WeekDay.Thursday),firstMonday=firstWeekDayOfMonth(year,month,WeekDay.Monday);if(day<firstMonday)return firstThursday<firstMonday?1:month>1?weekOfMonth(year,month-1,31):weekOfMonth(year-1,12,31);var lastMonday=lastWeekDayOfMonth(year,month,WeekDay.Monday),lastThursday=lastWeekDayOfMonth(year,month,WeekDay.Thursday);if(day>=lastMonday&&lastMonday>lastThursday)return 1;var result=Math.floor((day-firstMonday)/7)+1;return firstThursday<4&&(result+=1),result}function getWeekOneDayOfYear(year){var result=weekDayOnOrAfter(year,1,1,WeekDay.Monday)-1;return result>3&&(result-=7,result<0&&(result+=exports.daysInYear(year-1))),result}function weekNumber(year,month,day){var doy=dayOfYear(year,month,day);if(doy>=dayOfYear(year,12,29)){var nextYearWeekOne=getWeekOneDayOfYear(year+1);if(nextYearWeekOne>4&&nextYearWeekOne<=doy)return 1}var thisYearWeekOne=getWeekOneDayOfYear(year);if(thisYearWeekOne>4){var weekTwo=thisYearWeekOne+7-daysInYear(year-1);return doy<weekTwo?1:Math.floor((doy-weekTwo)/7)+2}return doy<thisYearWeekOne?weekNumber(year-1,12,31):Math.floor((doy-thisYearWeekOne)/7)+1}function assertUnixTimestamp(unixMillis){assert_1.default("number"==typeof unixMillis,"number input expected"),assert_1.default(!isNaN(unixMillis),"NaN not expected as input"),assert_1.default(math.isInt(unixMillis),"Expect integer number for unix UTC timestamp")}function unixToTimeNoLeapSecs(unixMillis){assertUnixTimestamp(unixMillis);var year,month,temp=unixMillis,result={year:0,month:0,day:0,hour:0,minute:0,second:0,milli:0};if(unixMillis>=0){for(result.milli=temp%1e3,temp=Math.floor(temp/1e3),result.second=temp%60,temp=Math.floor(temp/60),result.minute=temp%60,temp=Math.floor(temp/60),result.hour=temp%24,temp=Math.floor(temp/24),year=1970;temp>=daysInYear(year);)temp-=daysInYear(year),year++;for(result.year=year,month=1;temp>=daysInMonth(year,month);)temp-=daysInMonth(year,month),month++;result.month=month,result.day=temp+1}else{for(result.milli=math.positiveModulo(temp,1e3),temp=Math.floor(temp/1e3),result.second=math.positiveModulo(temp,60),temp=Math.floor(temp/60),result.minute=math.positiveModulo(temp,60),temp=Math.floor(temp/60),result.hour=math.positiveModulo(temp,24),temp=Math.floor(temp/24),year=1969;temp<-daysInYear(year);)temp+=daysInYear(year),year--;for(result.year=year,month=12;temp<-daysInMonth(year,month);)temp+=daysInMonth(year,month),month--;result.month=month,result.day=temp+1+daysInMonth(year,month)}return result}function normalizeTimeComponents(components){var input={year:"number"==typeof components.year?components.year:1970,month:"number"==typeof components.month?components.month:1,day:"number"==typeof components.day?components.day:1,hour:"number"==typeof components.hour?components.hour:0,minute:"number"==typeof components.minute?components.minute:0,second:"number"==typeof components.second?components.second:0,milli:"number"==typeof components.milli?components.milli:0};return input}function timeToUnixNoLeapSecs(a,month,day,hour,minute,second,milli){var components="number"==typeof a?{year:a,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli}:a,input=normalizeTimeComponents(components);return input.milli+1e3*(input.second+60*input.minute+3600*input.hour+86400*dayOfYear(input.year,input.month,input.day)+31536e3*(input.year-1970)+86400*Math.floor((input.year-1969)/4)-86400*Math.floor((input.year-1901)/100)+86400*Math.floor((input.year-1900+299)/400))}function weekDayNoLeapSecs(unixMillis){assertUnixTimestamp(unixMillis);var epochDay=WeekDay.Thursday,days=Math.floor(unixMillis/1e3/86400);return(epochDay+days)%7}function secondOfDay(hour,minute,second){return 60*(60*hour+minute)+second}function binaryInsertionIndex(arr,compare){var currentIndex,currentElement,minIndex=0,maxIndex=arr.length-1;if(!arr)return 0;if(0===arr.length)return 0;if(compare(arr[0])>0)return 0;if(compare(arr[maxIndex])<0)return maxIndex+1;for(;minIndex<=maxIndex;)if(currentIndex=Math.floor((minIndex+maxIndex)/2),currentElement=arr[currentIndex],compare(currentElement)<0)minIndex=currentIndex+1;else{if(!(compare(currentElement)>0))return currentIndex;maxIndex=currentIndex-1}return maxIndex}var assert_1=require("./assert"),javascript_1=require("./javascript"),math=require("./math"),strings=require("./strings");!function(WeekDay){WeekDay[WeekDay.Sunday=0]="Sunday",WeekDay[WeekDay.Monday=1]="Monday",WeekDay[WeekDay.Tuesday=2]="Tuesday",WeekDay[WeekDay.Wednesday=3]="Wednesday",WeekDay[WeekDay.Thursday=4]="Thursday",WeekDay[WeekDay.Friday=5]="Friday",WeekDay[WeekDay.Saturday=6]="Saturday"}(exports.WeekDay||(exports.WeekDay={}));var WeekDay=exports.WeekDay;!function(TimeUnit){TimeUnit[TimeUnit.Millisecond=0]="Millisecond",TimeUnit[TimeUnit.Second=1]="Second",TimeUnit[TimeUnit.Minute=2]="Minute",TimeUnit[TimeUnit.Hour=3]="Hour",TimeUnit[TimeUnit.Day=4]="Day",TimeUnit[TimeUnit.Week=5]="Week",TimeUnit[TimeUnit.Month=6]="Month",TimeUnit[TimeUnit.Year=7]="Year",TimeUnit[TimeUnit.MAX=8]="MAX"}(exports.TimeUnit||(exports.TimeUnit={}));var TimeUnit=exports.TimeUnit;exports.timeUnitToMilliseconds=timeUnitToMilliseconds,exports.timeUnitToString=timeUnitToString,exports.stringToTimeUnit=stringToTimeUnit,exports.isLeapYear=isLeapYear,exports.daysInYear=daysInYear,exports.daysInMonth=daysInMonth,exports.dayOfYear=dayOfYear,exports.lastWeekDayOfMonth=lastWeekDayOfMonth,exports.firstWeekDayOfMonth=firstWeekDayOfMonth,exports.weekDayOnOrAfter=weekDayOnOrAfter,exports.weekDayOnOrBefore=weekDayOnOrBefore,exports.weekOfMonth=weekOfMonth,exports.weekNumber=weekNumber,exports.unixToTimeNoLeapSecs=unixToTimeNoLeapSecs,exports.timeToUnixNoLeapSecs=timeToUnixNoLeapSecs,exports.weekDayNoLeapSecs=weekDayNoLeapSecs,exports.secondOfDay=secondOfDay;var TimeStruct=function(){function TimeStruct(a){"number"==typeof a?this._unixMillis=a:this._components=normalizeTimeComponents(a)}return TimeStruct.fromComponents=function(year,month,day,hour,minute,second,milli){return new TimeStruct({year:year,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli})},TimeStruct.fromUnix=function(unixMillis){return new TimeStruct(unixMillis)},TimeStruct.fromDate=function(d,df){return new TimeStruct(df===javascript_1.DateFunctions.Get?{year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate(),hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds(),milli:d.getMilliseconds()}:{year:d.getUTCFullYear(),month:d.getUTCMonth()+1,day:d.getUTCDate(),hour:d.getUTCHours(),minute:d.getUTCMinutes(),second:d.getUTCSeconds(),milli:d.getUTCMilliseconds()})},TimeStruct.fromString=function(s){try{var year=1970,month=1,day=1,hour=0,minute=0,second=0,fractionMillis=0,lastUnit=TimeUnit.Year,split=s.trim().split(".");assert_1.default(split.length>=1&&split.length<=2,"Empty string or multiple dots.");var isBasicFormat=s.indexOf("-")===-1;if(isBasicFormat)assert_1.default(split[0].match(/^((\d)+)|(\d\d\d\d\d\d\d\dT(\d)+)$/),"ISO string in basic notation may only contain numbers before the fractional part"),split[0]=split[0].replace("T",""),assert_1.default([4,8,10,12,14].indexOf(split[0].length)!==-1,"Padding or required components are missing. Note that YYYYMM is not valid per ISO 8601"),split[0].length>=4&&(year=parseInt(split[0].substr(0,4),10),lastUnit=TimeUnit.Year),split[0].length>=8&&(month=parseInt(split[0].substr(4,2),10),day=parseInt(split[0].substr(6,2),10),lastUnit=TimeUnit.Day),split[0].length>=10&&(hour=parseInt(split[0].substr(8,2),10),lastUnit=TimeUnit.Hour),split[0].length>=12&&(minute=parseInt(split[0].substr(10,2),10),lastUnit=TimeUnit.Minute),split[0].length>=14&&(second=parseInt(split[0].substr(12,2),10),lastUnit=TimeUnit.Second);else{assert_1.default(split[0].match(/^\d\d\d\d(-\d\d-\d\d((T)?\d\d(\:\d\d(:\d\d)?)?)?)?$/),"Invalid ISO string");var dateAndTime=[];dateAndTime=s.indexOf("T")!==-1?split[0].split("T"):s.length>10?[split[0].substr(0,10),split[0].substr(10)]:[split[0],""],assert_1.default([4,10].indexOf(dateAndTime[0].length)!==-1,"Padding or required components are missing. Note that YYYYMM is not valid per ISO 8601"),dateAndTime[0].length>=4&&(year=parseInt(dateAndTime[0].substr(0,4),10),lastUnit=TimeUnit.Year),dateAndTime[0].length>=10&&(month=parseInt(dateAndTime[0].substr(5,2),10),day=parseInt(dateAndTime[0].substr(8,2),10),lastUnit=TimeUnit.Day),dateAndTime[1].length>=2&&(hour=parseInt(dateAndTime[1].substr(0,2),10),lastUnit=TimeUnit.Hour),dateAndTime[1].length>=5&&(minute=parseInt(dateAndTime[1].substr(3,2),10),lastUnit=TimeUnit.Minute),dateAndTime[1].length>=8&&(second=parseInt(dateAndTime[1].substr(6,2),10),lastUnit=TimeUnit.Second)}if(split.length>1&&split[1].length>0){var fraction=parseFloat("0."+split[1]);switch(lastUnit){case TimeUnit.Year:fractionMillis=864e5*daysInYear(year)*fraction;break;case TimeUnit.Day:fractionMillis=864e5*fraction;break;case TimeUnit.Hour:fractionMillis=36e5*fraction;break;case TimeUnit.Minute:fractionMillis=6e4*fraction;break;case TimeUnit.Second:fractionMillis=1e3*fraction}}year=math.roundSym(year),month=math.roundSym(month),day=math.roundSym(day),hour=math.roundSym(hour),minute=math.roundSym(minute),second=math.roundSym(second);var unixMillis=timeToUnixNoLeapSecs({year:year,month:month,day:day,hour:hour,minute:minute,second:second});return unixMillis=math.roundSym(unixMillis+fractionMillis),new TimeStruct(unixMillis)}catch(e){throw new Error('Invalid ISO 8601 string: "'+s+'": '+e.message)}},Object.defineProperty(TimeStruct.prototype,"unixMillis",{get:function(){return void 0===this._unixMillis&&(this._unixMillis=timeToUnixNoLeapSecs(this._components)),this._unixMillis},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"components",{get:function(){return this._components||(this._components=unixToTimeNoLeapSecs(this._unixMillis)),this._components},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"year",{get:function(){return this.components.year},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"month",{get:function(){return this.components.month},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"day",{get:function(){return this.components.day},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"hour",{get:function(){return this.components.hour},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"minute",{get:function(){return this.components.minute},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"second",{get:function(){return this.components.second},enumerable:!0,configurable:!0}),Object.defineProperty(TimeStruct.prototype,"milli",{get:function(){return this.components.milli},enumerable:!0,configurable:!0}),TimeStruct.prototype.yearDay=function(){return dayOfYear(this.components.year,this.components.month,this.components.day)},TimeStruct.prototype.equals=function(other){return this.valueOf()===other.valueOf()},TimeStruct.prototype.valueOf=function(){return this.unixMillis},TimeStruct.prototype.clone=function(){return new TimeStruct(this._components?this._components:this._unixMillis)},TimeStruct.prototype.validate=function(){return!this._components||this.components.month>=1&&this.components.month<=12&&this.components.day>=1&&this.components.day<=daysInMonth(this.components.year,this.components.month)&&this.components.hour>=0&&this.components.hour<=23&&this.components.minute>=0&&this.components.minute<=59&&this.components.second>=0&&this.components.second<=59&&this.components.milli>=0&&this.components.milli<=999},TimeStruct.prototype.toString=function(){return strings.padLeft(this.components.year.toString(10),4,"0")+"-"+strings.padLeft(this.components.month.toString(10),2,"0")+"-"+strings.padLeft(this.components.day.toString(10),2,"0")+"T"+strings.padLeft(this.components.hour.toString(10),2,"0")+":"+strings.padLeft(this.components.minute.toString(10),2,"0")+":"+strings.padLeft(this.components.second.toString(10),2,"0")+"."+strings.padLeft(this.components.milli.toString(10),3,"0")},TimeStruct.prototype.inspect=function(){return"[TimeStruct: "+this.toString()+"]"},TimeStruct}();exports.TimeStruct=TimeStruct,exports.binaryInsertionIndex=binaryInsertionIndex},{"./assert":1,"./javascript":7,"./math":8,"./strings":11}],3:[function(require,module,exports){"use strict";function nowLocal(){return DateTime.nowLocal()}function nowUtc(){return DateTime.nowUtc()}function now(timeZone){return void 0===timeZone&&(timeZone=timezone_1.TimeZone.utc()),DateTime.now(timeZone)}function convertToUtc(localTime,fromZone){if(fromZone){var offset=fromZone.offsetForZone(localTime);return new basics_1.TimeStruct(localTime.unixMillis-6e4*offset)}return localTime.clone()}function convertFromUtc(utcTime,toZone){if(toZone){var offset=toZone.offsetForUtc(utcTime);return toZone.normalizeZoneTime(new basics_1.TimeStruct(utcTime.unixMillis+6e4*offset))}return utcTime.clone()}var assert_1=require("./assert"),basics_1=require("./basics"),basics=require("./basics"),duration_1=require("./duration"),javascript_1=require("./javascript"),math=require("./math"),timesource_1=require("./timesource"),timezone_1=require("./timezone"),tz_database_1=require("./tz-database"),format=require("./format"),parseFuncs=require("./parse");exports.nowLocal=nowLocal,exports.nowUtc=nowUtc,exports.now=now;var DateTime=function(){function DateTime(a1,a2,a3,h,m,s,ms,timeZone){switch(typeof a1){case"number":if(void 0===a2||null===a2||a2 instanceof timezone_1.TimeZone){assert_1.default("number"==typeof a1,"DateTime.DateTime(): expect unixTimestamp to be a number"),this._zone="object"==typeof a2&&a2 instanceof timezone_1.TimeZone?a2:null;this._zone?this._zoneDate=this._zone.normalizeZoneTime(new basics_1.TimeStruct(math.roundSym(a1))):this._zoneDate=new basics_1.TimeStruct(math.roundSym(a1))}else{assert_1.default("number"==typeof a1,"DateTime.DateTime(): Expect year to be a number."),assert_1.default("number"==typeof a2,"DateTime.DateTime(): Expect month to be a number."),assert_1.default("number"==typeof a3,"DateTime.DateTime(): Expect day to be a number.");var year=a1,month=a2,day=a3,hour="number"==typeof h?h:0,minute="number"==typeof m?m:0,second="number"==typeof s?s:0,milli="number"==typeof ms?ms:0;year=math.roundSym(year),month=math.roundSym(month),day=math.roundSym(day),hour=math.roundSym(hour),minute=math.roundSym(minute),second=math.roundSym(second),milli=math.roundSym(milli);var tm=new basics_1.TimeStruct({year:year,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli});assert_1.default(tm.validate(),"invalid date: "+tm.toString()),this._zone="object"==typeof timeZone&&timeZone instanceof timezone_1.TimeZone?timeZone:null,this._zone?this._zoneDate=this._zone.normalizeZoneTime(tm):this._zoneDate=tm}break;case"string":if("string"==typeof a2){var dateString=a1,formatString=a2,zone=null;"object"==typeof a3&&a3 instanceof timezone_1.TimeZone&&(zone=a3);var parsed=parseFuncs.parse(dateString,formatString,zone);this._zoneDate=parsed.time,this._zone=parsed.zone||null}else{var givenString=a1.trim(),ss=DateTime._splitDateFromTimeZone(givenString);assert_1.default(2===ss.length,'Invalid date string given: "'+a1+'"'),a2 instanceof timezone_1.TimeZone?this._zone=a2:this._zone=timezone_1.TimeZone.zone(ss[1]),this._zoneDate=basics_1.TimeStruct.fromString(ss[0]),this._zone&&(this._zoneDate=this._zone.normalizeZoneTime(this._zoneDate))}break;case"object":if(a1 instanceof basics_1.TimeStruct)this._zoneDate=a1.clone(),this._zone=a2?a2:null;else if(a1 instanceof Date){assert_1.default("number"==typeof a2,"DateTime.DateTime(): for a Date object a DateFunctions must be passed as second argument"),assert_1.default(!a3||a3 instanceof timezone_1.TimeZone,"DateTime.DateTime(): timeZone should be a TimeZone object.");var d=a1,dk=a2;this._zone=a3?a3:null,this._zoneDate=basics_1.TimeStruct.fromDate(d,dk),this._zone&&(this._zoneDate=this._zone.normalizeZoneTime(this._zoneDate))}break;case"undefined":this._zone=timezone_1.TimeZone.local(),this._utcDate=basics_1.TimeStruct.fromDate(DateTime.timeSource.now(),javascript_1.DateFunctions.GetUTC);break;default:throw new Error("DateTime.DateTime(): unexpected first argument type.")}}return Object.defineProperty(DateTime.prototype,"utcDate",{get:function(){return this._utcDate||(this._utcDate=convertToUtc(this._zoneDate,this._zone)),this._utcDate},set:function(value){this._utcDate=value,this._zoneDate=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(DateTime.prototype,"zoneDate",{get:function(){return this._zoneDate||(this._zoneDate=convertFromUtc(this._utcDate,this._zone)),this._zoneDate},set:function(value){this._zoneDate=value,this._utcDate=void 0},enumerable:!0,configurable:!0}),DateTime.nowLocal=function(){var n=DateTime.timeSource.now();return new DateTime(n,javascript_1.DateFunctions.Get,timezone_1.TimeZone.local())},DateTime.nowUtc=function(){return new DateTime(DateTime.timeSource.now(),javascript_1.DateFunctions.GetUTC,timezone_1.TimeZone.utc())},DateTime.now=function(timeZone){return void 0===timeZone&&(timeZone=timezone_1.TimeZone.utc()),new DateTime(DateTime.timeSource.now(),javascript_1.DateFunctions.GetUTC,timezone_1.TimeZone.utc()).toZone(timeZone)},DateTime.fromExcel=function(n,timeZone){assert_1.default("number"==typeof n,"fromExcel(): first parameter must be a number"),assert_1.default(!isNaN(n),"fromExcel(): first parameter must not be NaN"),assert_1.default(isFinite(n),"fromExcel(): first parameter must not be NaN");var unixTimestamp=Math.round(24*(n-25569)*60*60*1e3);return new DateTime(unixTimestamp,timeZone)},DateTime.exists=function(year,month,day,hour,minute,second,millisecond,zone,allowPre1970){if(void 0===month&&(month=1),void 0===day&&(day=1),void 0===hour&&(hour=0),void 0===minute&&(minute=0),void 0===second&&(second=0),void 0===millisecond&&(millisecond=0),void 0===zone&&(zone=null),void 0===allowPre1970&&(allowPre1970=!1),!(isFinite(year)&&isFinite(month)&&isFinite(day)&&isFinite(hour)&&isFinite(minute)&&isFinite(second)&&isFinite(millisecond)))return!1;if(!allowPre1970&&year<1970)return!1;try{var dt=new DateTime(year,month,day,hour,minute,second,millisecond,zone);return year===dt.year()&&month===dt.month()&&day===dt.day()&&hour===dt.hour()&&minute===dt.minute()&&second===dt.second()&&millisecond===dt.millisecond()}catch(e){return!1}},DateTime.prototype.clone=function(){return new DateTime(this.zoneDate,this._zone)},DateTime.prototype.zone=function(){return this._zone},DateTime.prototype.zoneAbbreviation=function(dstDependent){return void 0===dstDependent&&(dstDependent=!0),this.zone()?this.zone().abbreviationForUtc(this.utcDate,dstDependent):""},DateTime.prototype.offset=function(){return Math.round((this.zoneDate.unixMillis-this.utcDate.unixMillis)/6e4)},DateTime.prototype.offsetDuration=function(){return duration_1.Duration.milliseconds(Math.round(this.zoneDate.unixMillis-this.utcDate.unixMillis))},DateTime.prototype.standardOffsetDuration=function(){return this._zone?duration_1.Duration.minutes(this._zone.standardOffsetForUtc(this._utcDate)):duration_1.Duration.minutes(0)},DateTime.prototype.year=function(){return this.zoneDate.components.year},DateTime.prototype.month=function(){return this.zoneDate.components.month},DateTime.prototype.day=function(){return this.zoneDate.components.day},DateTime.prototype.hour=function(){return this.zoneDate.components.hour},DateTime.prototype.minute=function(){return this.zoneDate.components.minute},DateTime.prototype.second=function(){return this.zoneDate.components.second},DateTime.prototype.millisecond=function(){return this.zoneDate.components.milli},DateTime.prototype.weekDay=function(){return basics.weekDayNoLeapSecs(this.zoneDate.unixMillis)},DateTime.prototype.dayOfYear=function(){return this.zoneDate.yearDay()},DateTime.prototype.weekNumber=function(){return basics.weekNumber(this.year(),this.month(),this.day())},DateTime.prototype.weekOfMonth=function(){return basics.weekOfMonth(this.year(),this.month(),this.day())},DateTime.prototype.secondOfDay=function(){return basics.secondOfDay(this.hour(),this.minute(),this.second())},DateTime.prototype.unixUtcMillis=function(){return this.utcDate.unixMillis},DateTime.prototype.utcYear=function(){return this.utcDate.components.year},DateTime.prototype.utcMonth=function(){return this.utcDate.components.month},DateTime.prototype.utcDay=function(){return this.utcDate.components.day},DateTime.prototype.utcHour=function(){return this.utcDate.components.hour},DateTime.prototype.utcMinute=function(){return this.utcDate.components.minute},DateTime.prototype.utcSecond=function(){return this.utcDate.components.second},DateTime.prototype.utcDayOfYear=function(){return basics.dayOfYear(this.utcYear(),this.utcMonth(),this.utcDay())},DateTime.prototype.utcMillisecond=function(){return this.utcDate.components.milli},DateTime.prototype.utcWeekDay=function(){return basics.weekDayNoLeapSecs(this.utcDate.unixMillis)},DateTime.prototype.utcWeekNumber=function(){return basics.weekNumber(this.utcYear(),this.utcMonth(),this.utcDay())},DateTime.prototype.utcWeekOfMonth=function(){return basics.weekOfMonth(this.utcYear(),this.utcMonth(),this.utcDay())},DateTime.prototype.utcSecondOfDay=function(){return basics.secondOfDay(this.utcHour(),this.utcMinute(),this.utcSecond())},DateTime.prototype.withZone=function(zone){return new DateTime(this.year(),this.month(),this.day(),this.hour(),this.minute(),this.second(),this.millisecond(),zone)},DateTime.prototype.convert=function(zone){if(zone)assert_1.default(this._zone,"DateTime.toZone(): Cannot convert unaware date to an aware date"),this._zone.equals(zone)?this._zone=zone:(this._utcDate||(this._utcDate=convertToUtc(this._zoneDate,this._zone)),this._zone=zone,this._zoneDate=void 0);else{if(!this._zone)return;this._zoneDate||(this._zoneDate=convertFromUtc(this._utcDate,this._zone)),this._zone=null,this._utcDate=void 0}return this},DateTime.prototype.toZone=function(zone){if(zone){assert_1.default(this._zone,"DateTime.toZone(): Cannot convert unaware date to an aware date");var result=new DateTime;return result.utcDate=this.utcDate,result._zone=zone,result}return new DateTime(this.zoneDate,null)},DateTime.prototype.toDate=function(){return new Date(this.year(),this.month()-1,this.day(),this.hour(),this.minute(),this.second(),this.millisecond())},DateTime.prototype.toExcel=function(timeZone){var dt=this;timeZone&&!timeZone.equals(this.zone())&&(dt=this.toZone(timeZone));var offsetMillis=60*dt.offset()*1e3,unixTimestamp=dt.unixUtcMillis();return this._unixTimeStampToExcel(unixTimestamp+offsetMillis)},DateTime.prototype.toUtcExcel=function(){var unixTimestamp=this.unixUtcMillis();return this._unixTimeStampToExcel(unixTimestamp)},DateTime.prototype._unixTimeStampToExcel=function(n){var result=n/864e5+25569,msecs=result/(1/864e5);return Math.round(msecs)*(1/864e5)},DateTime.prototype.add=function(a1,unit){var amount,u;if("object"==typeof a1){var duration=a1;amount=duration.amount(),u=duration.unit()}else assert_1.default("number"==typeof a1,"expect number as first argument"),assert_1.default("number"==typeof unit,"expect number as second argument"),amount=a1,u=unit;var utcTm=this._addToTimeStruct(this.utcDate,amount,u);return new DateTime(utcTm,timezone_1.TimeZone.utc()).toZone(this._zone)},DateTime.prototype.addLocal=function(a1,unit){var amount,u;if("object"==typeof a1){var duration=a1;amount=duration.amount(),u=duration.unit()}else assert_1.default("number"==typeof a1,"expect number as first argument"),assert_1.default("number"==typeof unit,"expect number as second argument"),amount=a1,u=unit;var localTm=this._addToTimeStruct(this.zoneDate,amount,u);if(this._zone){var direction=amount>=0?tz_database_1.NormalizeOption.Up:tz_database_1.NormalizeOption.Down,normalized=this._zone.normalizeZoneTime(localTm,direction);return new DateTime(normalized,this._zone)}return new DateTime(localTm,null)},DateTime.prototype._addToTimeStruct=function(tm,amount,unit){var year,month,day,hour,minute,second,milli;switch(unit){case basics_1.TimeUnit.Millisecond:return new basics_1.TimeStruct(math.roundSym(tm.unixMillis+amount));case basics_1.TimeUnit.Second:return new basics_1.TimeStruct(math.roundSym(tm.unixMillis+1e3*amount));case basics_1.TimeUnit.Minute:return new basics_1.TimeStruct(math.roundSym(tm.unixMillis+6e4*amount));case basics_1.TimeUnit.Hour:return new basics_1.TimeStruct(math.roundSym(tm.unixMillis+36e5*amount));case basics_1.TimeUnit.Day:return new basics_1.TimeStruct(math.roundSym(tm.unixMillis+864e5*amount));case basics_1.TimeUnit.Week:return new basics_1.TimeStruct(math.roundSym(tm.unixMillis+7*amount*864e5));case basics_1.TimeUnit.Month:return assert_1.default(math.isInt(amount),"Cannot add/sub a non-integer amount of months"),amount>=0?(year=tm.components.year+Math.ceil((amount-(12-tm.components.month))/12),month=1+math.positiveModulo(tm.components.month-1+Math.floor(amount),12)):(year=tm.components.year+Math.floor((amount+(tm.components.month-1))/12),month=1+math.positiveModulo(tm.components.month-1+Math.ceil(amount),12)),day=Math.min(tm.components.day,basics.daysInMonth(year,month)),hour=tm.components.hour,minute=tm.components.minute,second=tm.components.second,milli=tm.components.milli,new basics_1.TimeStruct({year:year,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli});case basics_1.TimeUnit.Year:return assert_1.default(math.isInt(amount),"Cannot add/sub a non-integer amount of years"),year=tm.components.year+amount,month=tm.components.month,day=Math.min(tm.components.day,basics.daysInMonth(year,month)),hour=tm.components.hour,minute=tm.components.minute,second=tm.components.second,milli=tm.components.milli,new basics_1.TimeStruct({year:year,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli});default:throw new Error("Unknown period unit.")}},DateTime.prototype.sub=function(a1,unit){if("object"==typeof a1&&a1 instanceof duration_1.Duration){var duration=a1;return this.add(duration.multiply(-1))}assert_1.default("number"==typeof a1,"expect number as first argument"),assert_1.default("number"==typeof unit,"expect number as second argument");var amount=a1;return this.add(-1*amount,unit)},DateTime.prototype.subLocal=function(a1,unit){return"object"==typeof a1?this.addLocal(a1.multiply(-1)):this.addLocal(-1*a1,unit)},DateTime.prototype.diff=function(other){return new duration_1.Duration(this.utcDate.unixMillis-other.utcDate.unixMillis)},DateTime.prototype.startOfDay=function(){return new DateTime(this.year(),this.month(),this.day(),0,0,0,0,this.zone())},DateTime.prototype.startOfMonth=function(){return new DateTime(this.year(),this.month(),1,0,0,0,0,this.zone())},DateTime.prototype.startOfYear=function(){return new DateTime(this.year(),1,1,0,0,0,0,this.zone())},DateTime.prototype.lessThan=function(other){return this.utcDate.unixMillis<other.utcDate.unixMillis},DateTime.prototype.lessEqual=function(other){return this.utcDate.unixMillis<=other.utcDate.unixMillis},DateTime.prototype.equals=function(other){return this.utcDate.equals(other.utcDate)},DateTime.prototype.identical=function(other){return this.zoneDate.equals(other.zoneDate)&&null===this._zone==(null===other._zone)&&(null===this._zone||this._zone.identical(other._zone))},DateTime.prototype.greaterThan=function(other){return this.utcDate.unixMillis>other.utcDate.unixMillis},DateTime.prototype.greaterEqual=function(other){return this.utcDate.unixMillis>=other.utcDate.unixMillis},DateTime.prototype.min=function(other){return this.lessThan(other)?this.clone():other.clone()},DateTime.prototype.max=function(other){return this.greaterThan(other)?this.clone():other.clone()},DateTime.prototype.toIsoString=function(){var s=this.zoneDate.toString();return this._zone?s+timezone_1.TimeZone.offsetToString(this.offset()):s},DateTime.prototype.format=function(formatString,formatOptions){return format.format(this.zoneDate,this.utcDate,this.zone(),formatString,formatOptions)},DateTime.parse=function(s,format,zone){var parsed=parseFuncs.parse(s,format,zone);return new DateTime(parsed.time,parsed.zone)},DateTime.prototype.toString=function(){var s=this.zoneDate.toString();return this._zone?this._zone.kind()!==timezone_1.TimeZoneKind.Offset?s+" "+this._zone.toString():s+this._zone.toString():s},DateTime.prototype.inspect=function(){return"[DateTime: "+this.toString()+"]"},DateTime.prototype.valueOf=function(){return this.unixUtcMillis()},DateTime.prototype.toUtcString=function(){
return this.utcDate.toString()},DateTime._splitDateFromTimeZone=function(s){var trimmed=s.trim(),result=["",""],index=trimmed.lastIndexOf("without DST");if(index>-1){var result_1=DateTime._splitDateFromTimeZone(s.slice(0,index-1));return result_1[1]+=" without DST",result_1}return index=trimmed.lastIndexOf(" "),index>-1?(result[0]=trimmed.substr(0,index),result[1]=trimmed.substr(index+1),result):(index=trimmed.lastIndexOf("Z"),index>-1?(result[0]=trimmed.substr(0,index),result[1]=trimmed.substr(index,1),result):(index=trimmed.lastIndexOf("+"),index>-1?(result[0]=trimmed.substr(0,index),result[1]=trimmed.substr(index),result):(index=trimmed.lastIndexOf("-"),index<8&&(index=-1),index>-1?(result[0]=trimmed.substr(0,index),result[1]=trimmed.substr(index),result):(result[0]=trimmed,result))))},DateTime.timeSource=new timesource_1.RealTimeSource,DateTime}();exports.DateTime=DateTime},{"./assert":1,"./basics":2,"./duration":4,"./format":5,"./javascript":7,"./math":8,"./parse":9,"./timesource":12,"./timezone":13,"./tz-database":15}],4:[function(require,module,exports){"use strict";function years(n){return Duration.years(n)}function months(n){return Duration.months(n)}function days(n){return Duration.days(n)}function hours(n){return Duration.hours(n)}function minutes(n){return Duration.minutes(n)}function seconds(n){return Duration.seconds(n)}function milliseconds(n){return Duration.milliseconds(n)}var assert_1=require("./assert"),basics_1=require("./basics"),basics=require("./basics"),strings=require("./strings");exports.years=years,exports.months=months,exports.days=days,exports.hours=hours,exports.minutes=minutes,exports.seconds=seconds,exports.milliseconds=milliseconds;var Duration=function(){function Duration(i1,unit){if("number"==typeof i1){var amount=i1;this._amount=amount,this._unit="number"==typeof unit?unit:basics_1.TimeUnit.Millisecond}else"string"==typeof i1?this._fromString(i1):(this._amount=0,this._unit=basics_1.TimeUnit.Millisecond)}return Duration.years=function(n){return new Duration(n,basics_1.TimeUnit.Year)},Duration.months=function(n){return new Duration(n,basics_1.TimeUnit.Month)},Duration.days=function(n){return new Duration(n,basics_1.TimeUnit.Day)},Duration.hours=function(n){return new Duration(n,basics_1.TimeUnit.Hour)},Duration.minutes=function(n){return new Duration(n,basics_1.TimeUnit.Minute)},Duration.seconds=function(n){return new Duration(n,basics_1.TimeUnit.Second)},Duration.milliseconds=function(n){return new Duration(n,basics_1.TimeUnit.Millisecond)},Duration.prototype.clone=function(){return new Duration(this._amount,this._unit)},Duration.prototype.as=function(unit){if(this._unit===unit)return this._amount;if(this._unit>=basics_1.TimeUnit.Month&&unit>=basics_1.TimeUnit.Month){var thisMonths=this._unit===basics_1.TimeUnit.Year?12:1,reqMonths=unit===basics_1.TimeUnit.Year?12:1;return this._amount*thisMonths/reqMonths}var thisMsec=basics.timeUnitToMilliseconds(this._unit),reqMsec=basics.timeUnitToMilliseconds(unit);return this._amount*thisMsec/reqMsec},Duration.prototype.convert=function(unit){return new Duration(this.as(unit),unit)},Duration.prototype.milliseconds=function(){return this.as(basics_1.TimeUnit.Millisecond)},Duration.prototype.millisecond=function(){return this._part(basics_1.TimeUnit.Millisecond)},Duration.prototype.seconds=function(){return this.as(basics_1.TimeUnit.Second)},Duration.prototype.second=function(){return this._part(basics_1.TimeUnit.Second)},Duration.prototype.minutes=function(){return this.as(basics_1.TimeUnit.Minute)},Duration.prototype.minute=function(){return this._part(basics_1.TimeUnit.Minute)},Duration.prototype.hours=function(){return this.as(basics_1.TimeUnit.Hour)},Duration.prototype.hour=function(){return this._part(basics_1.TimeUnit.Hour)},Duration.prototype.wholeHours=function(){return Math.floor(basics.timeUnitToMilliseconds(this._unit)*Math.abs(this._amount)/36e5)},Duration.prototype.days=function(){return this.as(basics_1.TimeUnit.Day)},Duration.prototype.day=function(){return this._part(basics_1.TimeUnit.Day)},Duration.prototype.months=function(){return this.as(basics_1.TimeUnit.Month)},Duration.prototype.month=function(){return this._part(basics_1.TimeUnit.Month)},Duration.prototype.years=function(){return this.as(basics_1.TimeUnit.Year)},Duration.prototype.wholeYears=function(){return this._unit===basics_1.TimeUnit.Year?Math.floor(Math.abs(this._amount)):this._unit===basics_1.TimeUnit.Month?Math.floor(Math.abs(this._amount)/12):Math.floor(basics.timeUnitToMilliseconds(this._unit)*Math.abs(this._amount)/basics.timeUnitToMilliseconds(basics_1.TimeUnit.Year))},Duration.prototype.amount=function(){return this._amount},Duration.prototype.unit=function(){return this._unit},Duration.prototype.sign=function(){return this._amount<0?"-":""},Duration.prototype.lessThan=function(other){return this.milliseconds()<other.milliseconds()},Duration.prototype.lessEqual=function(other){return this.milliseconds()<=other.milliseconds()},Duration.prototype.equals=function(other){var converted=other.convert(this._unit);return this._amount===converted.amount()&&this._unit===converted.unit()},Duration.prototype.equalsExact=function(other){return this._unit>=basics_1.TimeUnit.Month&&other.unit()>=basics_1.TimeUnit.Month?this.equals(other):this._unit<=basics_1.TimeUnit.Day&&other.unit()<basics_1.TimeUnit.Day&&this.equals(other)},Duration.prototype.identical=function(other){return this._amount===other.amount()&&this._unit===other.unit()},Duration.prototype.greaterThan=function(other){return this.milliseconds()>other.milliseconds()},Duration.prototype.greaterEqual=function(other){return this.milliseconds()>=other.milliseconds()},Duration.prototype.min=function(other){return this.lessThan(other)?this.clone():other.clone()},Duration.prototype.max=function(other){return this.greaterThan(other)?this.clone():other.clone()},Duration.prototype.multiply=function(value){return new Duration(this._amount*value,this._unit)},Duration.prototype.divide=function(value){if("number"==typeof value){if(0===value)throw new Error("Duration.divide(): Divide by zero");return new Duration(this._amount/value,this._unit)}if(0===value._amount)throw new Error("Duration.divide(): Divide by zero duration");return this.milliseconds()/value.milliseconds()},Duration.prototype.add=function(value){return new Duration(this._amount+value.as(this._unit),this._unit)},Duration.prototype.sub=function(value){return new Duration(this._amount-value.as(this._unit),this._unit)},Duration.prototype.abs=function(){return this._amount>=0?this.clone():this.multiply(-1)},Duration.prototype.toFullString=function(){return this.toHmsString(!0)},Duration.prototype.toHmsString=function(full){void 0===full&&(full=!1);var result="";return(full||this.millisecond()>0)&&(result="."+strings.padLeft(this.millisecond().toString(10),3,"0")),(full||result.length>0||this.second()>0)&&(result=":"+strings.padLeft(this.second().toString(10),2,"0")+result),(full||result.length>0||this.minute()>0)&&(result=":"+strings.padLeft(this.minute().toString(10),2,"0")+result),this.sign()+strings.padLeft(this.wholeHours().toString(10),2,"0")+result},Duration.prototype.toIsoString=function(){switch(this._unit){case basics_1.TimeUnit.Millisecond:return"P"+(this._amount/1e3).toFixed(3)+"S";case basics_1.TimeUnit.Second:return"P"+this._amount.toString(10)+"S";case basics_1.TimeUnit.Minute:return"PT"+this._amount.toString(10)+"M";case basics_1.TimeUnit.Hour:return"P"+this._amount.toString(10)+"H";case basics_1.TimeUnit.Day:return"P"+this._amount.toString(10)+"D";case basics_1.TimeUnit.Week:return"P"+this._amount.toString(10)+"W";case basics_1.TimeUnit.Month:return"P"+this._amount.toString(10)+"M";case basics_1.TimeUnit.Year:return"P"+this._amount.toString(10)+"Y";default:throw new Error("Unknown period unit.")}},Duration.prototype.toString=function(){return this._amount.toString(10)+" "+basics.timeUnitToString(this._unit,this._amount)},Duration.prototype.inspect=function(){return"[Duration: "+this.toString()+"]"},Duration.prototype.valueOf=function(){return this.milliseconds()},Duration.prototype._part=function(unit){if(unit===basics_1.TimeUnit.Year)return Math.floor(Math.abs(this.as(basics_1.TimeUnit.Year)));var nextUnit;switch(unit){case basics_1.TimeUnit.Millisecond:nextUnit=basics_1.TimeUnit.Second;break;case basics_1.TimeUnit.Second:nextUnit=basics_1.TimeUnit.Minute;break;case basics_1.TimeUnit.Minute:nextUnit=basics_1.TimeUnit.Hour;break;case basics_1.TimeUnit.Hour:nextUnit=basics_1.TimeUnit.Day;break;case basics_1.TimeUnit.Day:nextUnit=basics_1.TimeUnit.Month;break;case basics_1.TimeUnit.Month:nextUnit=basics_1.TimeUnit.Year}var msecs=basics.timeUnitToMilliseconds(this._unit)*Math.abs(this._amount)%basics.timeUnitToMilliseconds(nextUnit);return Math.floor(msecs/basics.timeUnitToMilliseconds(unit))},Duration.prototype._fromString=function(s){var trimmed=s.trim();if(trimmed.match(/^-?\d\d?(:\d\d?(:\d\d?(.\d\d?\d?)?)?)?$/)){var sign=1,hours_1=0,minutes_1=0,seconds_1=0,milliseconds_1=0,parts=trimmed.split(":");if(assert_1.default(parts.length>0&&parts.length<4,'Not a proper time duration string: "'+trimmed+'"'),"-"===trimmed.charAt(0)&&(sign=-1,parts[0]=parts[0].substr(1)),parts.length>0&&(hours_1=+parts[0]),parts.length>1&&(minutes_1=+parts[1]),parts.length>2){var secondParts=parts[2].split(".");seconds_1=+secondParts[0],secondParts.length>1&&(milliseconds_1=+strings.padRight(secondParts[1],3,"0"))}var amountMsec=sign*Math.round(milliseconds_1+1e3*seconds_1+6e4*minutes_1+36e5*hours_1);0!==milliseconds_1?this._unit=basics_1.TimeUnit.Millisecond:0!==seconds_1?this._unit=basics_1.TimeUnit.Second:0!==minutes_1?this._unit=basics_1.TimeUnit.Minute:0!==hours_1?this._unit=basics_1.TimeUnit.Hour:this._unit=basics_1.TimeUnit.Millisecond,this._amount=amountMsec/basics.timeUnitToMilliseconds(this._unit)}else{var split=trimmed.toLowerCase().split(" ");if(2!==split.length)throw new Error("Invalid time string '"+s+"'");var amount=parseFloat(split[0]);assert_1.default(!isNaN(amount),"Invalid time string '"+s+"', cannot parse amount"),assert_1.default(isFinite(amount),"Invalid time string '"+s+"', amount is infinite"),this._amount=amount,this._unit=basics.stringToTimeUnit(split[1])}},Duration}();exports.Duration=Duration},{"./assert":1,"./basics":2,"./strings":11}],5:[function(require,module,exports){"use strict";function format(dateTime,utcTime,localZone,formatString,formatOptions){void 0===formatOptions&&(formatOptions={});var givenFormatOptions=formatOptions,defaultFormatOptions=exports.DEFAULT_FORMAT_OPTIONS,mergedFormatOptions={};for(var name_1 in exports.DEFAULT_FORMAT_OPTIONS)if(exports.DEFAULT_FORMAT_OPTIONS.hasOwnProperty(name_1)){var givenFormatOption=givenFormatOptions[name_1],defaultFormatOption=defaultFormatOptions[name_1];mergedFormatOptions[name_1]=givenFormatOption||defaultFormatOption}formatOptions=mergedFormatOptions;for(var tokenizer=new token_1.Tokenizer(formatString),tokens=tokenizer.parseTokens(),result="",i=0;i<tokens.length;++i){var token=tokens[i],tokenResult=void 0;switch(token.type){case token_1.DateTimeTokenType.ERA:tokenResult=_formatEra(dateTime,token);break;case token_1.DateTimeTokenType.YEAR:tokenResult=_formatYear(dateTime,token);break;case token_1.DateTimeTokenType.QUARTER:tokenResult=_formatQuarter(dateTime,token,formatOptions);break;case token_1.DateTimeTokenType.MONTH:tokenResult=_formatMonth(dateTime,token,formatOptions);break;case token_1.DateTimeTokenType.DAY:tokenResult=_formatDay(dateTime,token);break;case token_1.DateTimeTokenType.WEEKDAY:tokenResult=_formatWeekday(dateTime,token,formatOptions);break;case token_1.DateTimeTokenType.DAYPERIOD:tokenResult=_formatDayPeriod(dateTime,token);break;case token_1.DateTimeTokenType.HOUR:tokenResult=_formatHour(dateTime,token);break;case token_1.DateTimeTokenType.MINUTE:tokenResult=_formatMinute(dateTime,token);break;case token_1.DateTimeTokenType.SECOND:tokenResult=_formatSecond(dateTime,token);break;case token_1.DateTimeTokenType.ZONE:tokenResult=_formatZone(dateTime,utcTime,localZone,token);break;case token_1.DateTimeTokenType.WEEK:tokenResult=_formatWeek(dateTime,token);break;default:case token_1.DateTimeTokenType.IDENTITY:tokenResult=token.raw}result+=tokenResult}return result.trim()}function _formatEra(dateTime,token){var AD=dateTime.year>0;switch(token.length){case 1:case 2:case 3:return AD?"AD":"BC";case 4:return AD?"Anno Domini":"Before Christ";case 5:return AD?"A":"B";default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}}function _formatYear(dateTime,token){switch(token.symbol){case"y":case"Y":case"r":var yearValue=strings.padLeft(dateTime.year.toString(),token.length,"0");return 2===token.length&&(yearValue=yearValue.slice(-2)),yearValue;default:throw new Error("Unexpected symbol "+token.symbol+" for token "+token_1.DateTimeTokenType[token.type])}}function _formatQuarter(dateTime,token,formatOptions){var quarter=Math.ceil(dateTime.month/3);switch(token.length){case 1:case 2:return strings.padLeft(quarter.toString(),2,"0");case 3:return formatOptions.quarterLetter+quarter;case 4:return formatOptions.quarterAbbreviations[quarter-1]+" "+formatOptions.quarterWord;case 5:return quarter.toString();default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}}function _formatMonth(dateTime,token,formatOptions){switch(token.length){case 1:case 2:return strings.padLeft(dateTime.month.toString(),token.length,"0");case 3:return formatOptions.shortMonthNames[dateTime.month-1];case 4:return formatOptions.longMonthNames[dateTime.month-1];case 5:return formatOptions.monthLetters[dateTime.month-1];default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}}function _formatWeek(dateTime,token){return"w"===token.symbol?strings.padLeft(basics.weekNumber(dateTime.year,dateTime.month,dateTime.day).toString(),token.length,"0"):strings.padLeft(basics.weekOfMonth(dateTime.year,dateTime.month,dateTime.day).toString(),token.length,"0")}function _formatDay(dateTime,token){switch(token.symbol){case"d":return strings.padLeft(dateTime.day.toString(),token.length,"0");case"D":var dayOfYear=basics.dayOfYear(dateTime.year,dateTime.month,dateTime.day)+1;return strings.padLeft(dayOfYear.toString(),token.length,"0");default:throw new Error("Unexpected symbol "+token.symbol+" for token "+token_1.DateTimeTokenType[token.type])}}function _formatWeekday(dateTime,token,formatOptions){var weekDayNumber=basics.weekDayNoLeapSecs(dateTime.unixMillis);switch(token.length){case 1:case 2:if("e"===token.symbol)return strings.padLeft(basics.weekDayNoLeapSecs(dateTime.unixMillis).toString(),token.length,"0");case 3:return formatOptions.shortWeekdayNames[weekDayNumber];case 4:return formatOptions.longWeekdayNames[weekDayNumber];case 5:return formatOptions.weekdayLetters[weekDayNumber];case 6:return formatOptions.weekdayTwoLetters[weekDayNumber];default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}}function _formatDayPeriod(dateTime,token){return dateTime.hour<12?"AM":"PM"}function _formatHour(dateTime,token){var hour=dateTime.hour;switch(token.symbol){case"h":return hour%=12,0===hour&&(hour=12),strings.padLeft(hour.toString(),token.length,"0");case"H":return strings.padLeft(hour.toString(),token.length,"0");case"K":return hour%=12,strings.padLeft(hour.toString(),token.length,"0");case"k":return 0===hour&&(hour=24),strings.padLeft(hour.toString(),token.length,"0");default:throw new Error("Unexpected symbol "+token.symbol+" for token "+token_1.DateTimeTokenType[token.type])}}function _formatMinute(dateTime,token){return strings.padLeft(dateTime.minute.toString(),token.length,"0")}function _formatSecond(dateTime,token){switch(token.symbol){case"s":return strings.padLeft(dateTime.second.toString(),token.length,"0");case"S":var fraction=dateTime.milli,fractionString=strings.padLeft(fraction.toString(),3,"0");return fractionString=strings.padRight(fractionString,token.length,"0"),fractionString.slice(0,token.length);case"A":return strings.padLeft(basics.secondOfDay(dateTime.hour,dateTime.minute,dateTime.second).toString(),token.length,"0");default:throw new Error("Unexpected symbol "+token.symbol+" for token "+token_1.DateTimeTokenType[token.type])}}function _formatZone(currentTime,utcTime,zone,token){if(!zone)return"";var offset=Math.round((currentTime.unixMillis-utcTime.unixMillis)/6e4),offsetHours=Math.floor(Math.abs(offset)/60),offsetHoursString=strings.padLeft(offsetHours.toString(),2,"0");offsetHoursString=offset>=0?"+"+offsetHoursString:"-"+offsetHoursString;var result,offsetMinutes=Math.abs(offset%60),offsetMinutesString=strings.padLeft(offsetMinutes.toString(),2,"0");switch(token.symbol){case"O":return result="UTC",result+=offset>=0?"+":"-",result+=offsetHours.toString(),(token.length>=4||0!==offsetMinutes)&&(result+=":"+offsetMinutesString),result;case"Z":switch(token.length){case 1:case 2:case 3:return offsetHoursString+offsetMinutesString;case 4:var newToken={length:4,raw:"OOOO",symbol:"O",type:token_1.DateTimeTokenType.ZONE};return _formatZone(currentTime,utcTime,zone,newToken);case 5:return offsetHoursString+":"+offsetMinutesString;default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}case"z":switch(token.length){case 1:case 2:case 3:return zone.abbreviationForUtc(currentTime,!0);case 4:return zone.toString();default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}case"v":return 1===token.length?zone.abbreviationForUtc(currentTime,!1):zone.toString();case"V":switch(token.length){case 1:return"unk";case 2:return zone.name();case 3:case 4:return"Unknown";default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}case"X":if(0===offset)return"Z";case"x":switch(token.length){case 1:return result=offsetHoursString,0!==offsetMinutes&&(result+=offsetMinutesString),result;case 2:case 4:return offsetHoursString+offsetMinutesString;case 3:case 5:return offsetHoursString+":"+offsetMinutesString;default:throw new Error("Unexpected length "+token.length+" for symbol "+token.symbol)}default:throw new Error("Unexpected symbol "+token.symbol+" for token "+token_1.DateTimeTokenType[token.type])}}var basics=require("./basics"),token_1=require("./token"),strings=require("./strings");exports.LONG_MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December"],exports.SHORT_MONTH_NAMES=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],exports.MONTH_LETTERS=["J","F","M","A","M","J","J","A","S","O","N","D"],exports.LONG_WEEKDAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],exports.SHORT_WEEKDAY_NAMES=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],exports.WEEKDAY_TWO_LETTERS=["Su","Mo","Tu","We","Th","Fr","Sa"],exports.WEEKDAY_LETTERS=["S","M","T","W","T","F","S"],exports.QUARTER_LETTER="Q",exports.QUARTER_WORD="quarter",exports.QUARTER_ABBREVIATIONS=["1st","2nd","3rd","4th"],exports.DEFAULT_FORMAT_OPTIONS={quarterLetter:exports.QUARTER_LETTER,quarterWord:exports.QUARTER_WORD,quarterAbbreviations:exports.QUARTER_ABBREVIATIONS,longMonthNames:exports.LONG_MONTH_NAMES,shortMonthNames:exports.SHORT_MONTH_NAMES,monthLetters:exports.MONTH_LETTERS,longWeekdayNames:exports.LONG_WEEKDAY_NAMES,shortWeekdayNames:exports.SHORT_WEEKDAY_NAMES,weekdayTwoLetters:exports.WEEKDAY_TWO_LETTERS,weekdayLetters:exports.WEEKDAY_LETTERS},exports.format=format},{"./basics":2,"./strings":11,"./token":14}],6:[function(require,module,exports){"use strict";function min(d1,d2){return assert_1.default(d1,"first argument is null"),assert_1.default(d2,"first argument is null"),assert_1.default(d1 instanceof datetime_1.DateTime&&d2 instanceof datetime_1.DateTime||d1 instanceof duration_1.Duration&&d2 instanceof duration_1.Duration,"Either two datetimes or two durations expected"),d1.min(d2)}function max(d1,d2){return assert_1.default(d1,"first argument is null"),assert_1.default(d2,"first argument is null"),assert_1.default(d1 instanceof datetime_1.DateTime&&d2 instanceof datetime_1.DateTime||d1 instanceof duration_1.Duration&&d2 instanceof duration_1.Duration,"Either two datetimes or two durations expected"),d1.max(d2)}function abs(d){return assert_1.default(d,"first argument is null"),assert_1.default(d instanceof duration_1.Duration,"first argument is not a Duration"),d.abs()}var assert_1=require("./assert"),datetime_1=require("./datetime"),duration_1=require("./duration");exports.min=min,exports.max=max,exports.abs=abs},{"./assert":1,"./datetime":3,"./duration":4}],7:[function(require,module,exports){"use strict";!function(DateFunctions){DateFunctions[DateFunctions.Get=0]="Get",DateFunctions[DateFunctions.GetUTC=1]="GetUTC"}(exports.DateFunctions||(exports.DateFunctions={}));exports.DateFunctions},{}],8:[function(require,module,exports){"use strict";function isInt(n){return"number"==typeof n&&(!isNaN(n)&&Math.floor(n)===n)}function roundSym(n){return n<0?-1*Math.round(-1*n):Math.round(n)}function filterFloat(value){return/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/.test(value)?Number(value):NaN}function positiveModulo(value,modulo){return assert_1.default(modulo>=1,"modulo should be >= 1"),value<0?(value%modulo+modulo)%modulo:value%modulo}var assert_1=require("./assert");exports.isInt=isInt,exports.roundSym=roundSym,exports.filterFloat=filterFloat,exports.positiveModulo=positiveModulo},{"./assert":1}],9:[function(require,module,exports){"use strict";function parseable(dateTimeString,formatString,allowTrailing){void 0===allowTrailing&&(allowTrailing=!0);try{return parse(dateTimeString,formatString,null,allowTrailing),!0}catch(e){return!1}}function parse(dateTimeString,formatString,overrideZone,allowTrailing){if(void 0===allowTrailing&&(allowTrailing=!0),!dateTimeString)throw new Error("no date given");if(!formatString)throw new Error("no format given");try{for(var tokenizer=new token_1.Tokenizer(formatString),tokens=tokenizer.parseTokens(),time={year:-1},zone=void 0,pnr=void 0,pzr=void 0,remaining=dateTimeString,i=0;i<tokens.length;++i){var token=tokens[i];switch(token.type){case token_1.DateTimeTokenType.ERA:break;case token_1.DateTimeTokenType.YEAR:pnr=stripNumber(remaining),remaining=pnr.remaining,time.year=pnr.n;break;case token_1.DateTimeTokenType.QUARTER:break;case token_1.DateTimeTokenType.MONTH:pnr=stripNumber(remaining),remaining=pnr.remaining,time.month=pnr.n;break;case token_1.DateTimeTokenType.DAY:pnr=stripNumber(remaining),remaining=pnr.remaining,time.day=pnr.n;break;case token_1.DateTimeTokenType.WEEKDAY:break;case token_1.DateTimeTokenType.DAYPERIOD:break;case token_1.DateTimeTokenType.HOUR:pnr=stripNumber(remaining),remaining=pnr.remaining,time.hour=pnr.n;break;case token_1.DateTimeTokenType.MINUTE:pnr=stripNumber(remaining),remaining=pnr.remaining,time.minute=pnr.n;break;case token_1.DateTimeTokenType.SECOND:if(pnr=stripNumber(remaining),remaining=pnr.remaining,"s"===token.raw.charAt(0))time.second=pnr.n;else{if("S"!==token.raw.charAt(0))throw new Error("unsupported second format '"+token.raw+"'");time.milli=pnr.n}break;case token_1.DateTimeTokenType.ZONE:pzr=stripZone(remaining),remaining=pzr.remaining,zone=pzr.zone;break;case token_1.DateTimeTokenType.WEEK:break;default:case token_1.DateTimeTokenType.IDENTITY:remaining=stripRaw(remaining,token.raw)}}var result={time:new basics_1.TimeStruct(time),zone:zone||null};if(!result.time.validate())throw new Error("resulting date invalid");if(overrideZone&&(result.zone=overrideZone),remaining&&!allowTrailing)throw new Error("invalid date '"+dateTimeString+"' not according to format '"+formatString+"': trailing characters: 'remaining'");return result}catch(e){throw new Error("invalid date '"+dateTimeString+"' not according to format '"+formatString+"': "+e.message)}}function stripNumber(s){for(var result={n:NaN,remaining:s},numberString="";result.remaining.length>0&&result.remaining.charAt(0).match(/\d/);)numberString+=result.remaining.charAt(0),result.remaining=result.remaining.substr(1);for(;"0"===numberString.charAt(0)&&numberString.length>1;)numberString=numberString.substr(1);if(result.n=parseInt(numberString,10),""===numberString||!isFinite(result.n))throw new Error("expected a number but got '"+numberString+"'");return result}function stripZone(s){if(0===s.length)throw new Error("no zone given");for(var result={zone:null,remaining:s},zoneString="";result.remaining.length>0&&WHITESPACE.indexOf(result.remaining.charAt(0))===-1;)zoneString+=result.remaining.charAt(0),result.remaining=result.remaining.substr(1);return result.zone=timezone_1.TimeZone.zone(zoneString),result}function stripRaw(s,expected){for(var remaining=s,eremaining=expected;remaining.length>0&&eremaining.length>0&&remaining.charAt(0)===eremaining.charAt(0);)remaining=remaining.substr(1),eremaining=eremaining.substr(1);if(eremaining.length>0)throw new Error("expected '"+expected+"'");return remaining}var basics_1=require("./basics"),token_1=require("./token"),timezone_1=require("./timezone");exports.parseable=parseable,exports.parse=parse;var WHITESPACE=[" ","\t","\r","\v","\n"]},{"./basics":2,"./timezone":13,"./token":14}],10:[function(require,module,exports){"use strict";function periodDstToString(p){switch(p){case PeriodDst.RegularIntervals:return"regular intervals";case PeriodDst.RegularLocalTime:return"regular local time";default:throw new Error("Unknown PeriodDst")}}var assert_1=require("./assert"),basics_1=require("./basics"),basics=require("./basics"),duration_1=require("./duration"),datetime_1=require("./datetime"),timezone_1=require("./timezone");!function(PeriodDst){PeriodDst[PeriodDst.RegularIntervals=0]="RegularIntervals",PeriodDst[PeriodDst.RegularLocalTime=1]="RegularLocalTime",PeriodDst[PeriodDst.MAX=2]="MAX"}(exports.PeriodDst||(exports.PeriodDst={}));var PeriodDst=exports.PeriodDst;exports.periodDstToString=periodDstToString;var Period=function(){function Period(reference,amountOrInterval,unitOrDst,givenDst){var interval,dst=PeriodDst.RegularLocalTime;if("object"==typeof amountOrInterval?(interval=amountOrInterval,dst=unitOrDst):(assert_1.default("number"==typeof unitOrDst&&unitOrDst>=0&&unitOrDst<basics_1.TimeUnit.MAX,"Invalid unit"),interval=new duration_1.Duration(amountOrInterval,unitOrDst),dst=givenDst),"number"!=typeof dst&&(dst=PeriodDst.RegularLocalTime),assert_1.default(dst>=0&&dst<PeriodDst.MAX,"Invalid PeriodDst setting"),assert_1.default(!!reference,"Reference time not given"),assert_1.default(interval.amount()>0,"Amount must be positive non-zero."),assert_1.default(Math.floor(interval.amount())===interval.amount(),"Amount must be a whole number"),this._reference=reference,this._interval=interval,this._dst=dst,this._calcInternalValues(),this._dstRelevant()&&dst===PeriodDst.RegularLocalTime)switch(this._intInterval.unit()){case basics_1.TimeUnit.Millisecond:assert_1.default(this._intInterval.amount()<864e5,"When using Hour, Minute or (Milli)Second units, with Regular Local Times, then the amount must be either less than a day or a multiple of the next unit.");break;case basics_1.TimeUnit.Second:assert_1.default(this._intInterval.amount()<86400,"When using Hour, Minute or (Milli)Second units, with Regular Local Times, then the amount must be either less than a day or a multiple of the next unit.");break;case basics_1.TimeUnit.Minute:assert_1.default(this._intInterval.amount()<1440,"When using Hour, Minute or (Milli)Second units, with Regular Local Times, then the amount must be either less than a day or a multiple of the next unit.");break;case basics_1.TimeUnit.Hour:assert_1.default(this._intInterval.amount()<24,"When using Hour, Minute or (Milli)Second units, with Regular Local Times, then the amount must be either less than a day or a multiple of the next unit.")}}return Period.prototype.clone=function(){return new Period(this._reference,this._interval,this._dst)},Period.prototype.reference=function(){return this._reference},Period.prototype.start=function(){return this._reference},Period.prototype.interval=function(){return this._interval.clone()},Period.prototype.amount=function(){return this._interval.amount()},Period.prototype.unit=function(){return this._interval.unit()},Period.prototype.dst=function(){return this._dst},Period.prototype.findFirst=function(fromDate){assert_1.default(!!this._intReference.zone()==!!fromDate.zone(),"The fromDate and reference date must both be aware or unaware");var approx,approx2,approxMin,periods,diff,newYear,remainder,imax,imin,imid,normalFrom=this._normalizeDay(fromDate.toZone(this._intReference.zone()));if(1===this._intInterval.amount())if(this._intDst===PeriodDst.RegularIntervals){switch(this._intInterval.unit()){case basics_1.TimeUnit.Millisecond:approx=new datetime_1.DateTime(normalFrom.utcYear(),normalFrom.utcMonth(),normalFrom.utcDay(),normalFrom.utcHour(),normalFrom.utcMinute(),normalFrom.utcSecond(),normalFrom.utcMillisecond(),timezone_1.TimeZone.utc());break;case basics_1.TimeUnit.Second:approx=new datetime_1.DateTime(normalFrom.utcYear(),normalFrom.utcMonth(),normalFrom.utcDay(),normalFrom.utcHour(),normalFrom.utcMinute(),normalFrom.utcSecond(),this._intReference.utcMillisecond(),timezone_1.TimeZone.utc());break;case basics_1.TimeUnit.Minute:approx=new datetime_1.DateTime(normalFrom.utcYear(),normalFrom.utcMonth(),normalFrom.utcDay(),normalFrom.utcHour(),normalFrom.utcMinute(),this._intReference.utcSecond(),this._intReference.utcMillisecond(),timezone_1.TimeZone.utc());break;case basics_1.TimeUnit.Hour:approx=new datetime_1.DateTime(normalFrom.utcYear(),normalFrom.utcMonth(),normalFrom.utcDay(),normalFrom.utcHour(),this._intReference.utcMinute(),this._intReference.utcSecond(),this._intReference.utcMillisecond(),timezone_1.TimeZone.utc());break;case basics_1.TimeUnit.Day:approx=new datetime_1.DateTime(normalFrom.utcYear(),normalFrom.utcMonth(),normalFrom.utcDay(),this._intReference.utcHour(),this._intReference.utcMinute(),this._intReference.utcSecond(),this._intReference.utcMillisecond(),timezone_1.TimeZone.utc());break;case basics_1.TimeUnit.Month:approx=new datetime_1.DateTime(normalFrom.utcYear(),normalFrom.utcMonth(),this._intReference.utcDay(),this._intReference.utcHour(),this._intReference.utcMinute(),this._intReference.utcSecond(),this._intReference.utcMillisecond(),timezone_1.TimeZone.utc());break;case basics_1.TimeUnit.Year:approx=new datetime_1.DateTime(normalFrom.utcYear(),this._intReference.utcMonth(),this._intReference.utcDay(),this._intReference.utcHour(),this._intReference.utcMinute(),this._intReference.utcSecond(),this._intReference.utcMillisecond(),timezone_1.TimeZone.utc());break;default:throw new Error("Unknown TimeUnit")}for(;!approx.greaterThan(fromDate);)approx=approx.add(this._intInterval.amount(),this._intInterval.unit())}else{switch(this._intInterval.unit()){case basics_1.TimeUnit.Millisecond:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),normalFrom.minute(),normalFrom.second(),normalFrom.millisecond(),this._intReference.zone());break;case basics_1.TimeUnit.Second:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),normalFrom.minute(),normalFrom.second(),this._intReference.millisecond(),this._intReference.zone());break;case basics_1.TimeUnit.Minute:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),normalFrom.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone());break;case basics_1.TimeUnit.Hour:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone());break;case basics_1.TimeUnit.Day:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone());
break;case basics_1.TimeUnit.Month:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),this._intReference.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone());break;case basics_1.TimeUnit.Year:approx=new datetime_1.DateTime(normalFrom.year(),this._intReference.month(),this._intReference.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone());break;default:throw new Error("Unknown TimeUnit")}for(;!approx.greaterThan(normalFrom);)approx=approx.addLocal(this._intInterval.amount(),this._intInterval.unit())}else if(this._intDst===PeriodDst.RegularIntervals){switch(this._intInterval.unit()){case basics_1.TimeUnit.Millisecond:diff=normalFrom.diff(this._intReference).milliseconds(),periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Second:diff=normalFrom.diff(this._intReference).seconds(),periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Minute:diff=normalFrom.diff(this._intReference).minutes(),periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Hour:diff=normalFrom.diff(this._intReference).hours(),periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Day:diff=normalFrom.diff(this._intReference).hours()/24,periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Month:diff=12*(normalFrom.utcYear()-this._intReference.utcYear())+(normalFrom.utcMonth()-this._intReference.utcMonth())-1,periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Year:diff=normalFrom.year()-this._intReference.year()-1,periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.add(periods*this._intInterval.amount(),basics_1.TimeUnit.Year);break;default:throw new Error("Unknown TimeUnit")}for(;!approx.greaterThan(fromDate);)approx=approx.add(this._intInterval.amount(),this._intInterval.unit())}else{switch(this._intInterval.unit()){case basics_1.TimeUnit.Millisecond:if(this._intInterval.amount()<1e3&&1e3%this._intInterval.amount()===0)approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),normalFrom.minute(),normalFrom.second(),this._intReference.millisecond(),this._intReference.zone()).subLocal(1,basics_1.TimeUnit.Second);else for(approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone()),remainder=Math.floor(864e5%this._intInterval.amount()),approx.greaterThan(normalFrom)?approx.subLocal(remainder,basics_1.TimeUnit.Millisecond).greaterThan(normalFrom)&&(approx=approx.subLocal(1,basics_1.TimeUnit.Day)):approx.addLocal(1,basics_1.TimeUnit.Day).subLocal(remainder,basics_1.TimeUnit.Millisecond).lessEqual(normalFrom)&&(approx=approx.addLocal(1,basics_1.TimeUnit.Day)),imax=Math.floor(864e5/this._intInterval.amount()),imin=0;imax>=imin;){if(imid=Math.floor((imin+imax)/2),approx2=approx.addLocal(imid*this._intInterval.amount(),basics_1.TimeUnit.Millisecond),approxMin=approx2.subLocal(this._intInterval.amount(),basics_1.TimeUnit.Millisecond),approx2.greaterThan(normalFrom)&&approxMin.lessEqual(normalFrom)){approx=approx2;break}approx2.lessEqual(normalFrom)?imin=imid+1:imax=imid-1}break;case basics_1.TimeUnit.Second:if(this._intInterval.amount()<60&&60%this._intInterval.amount()===0)approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),normalFrom.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone()).subLocal(1,basics_1.TimeUnit.Minute);else for(approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone()),remainder=Math.floor(86400%this._intInterval.amount()),approx.greaterThan(normalFrom)?approx.subLocal(remainder,basics_1.TimeUnit.Second).greaterThan(normalFrom)&&(approx=approx.subLocal(1,basics_1.TimeUnit.Day)):approx.addLocal(1,basics_1.TimeUnit.Day).subLocal(remainder,basics_1.TimeUnit.Second).lessEqual(normalFrom)&&(approx=approx.addLocal(1,basics_1.TimeUnit.Day)),imax=Math.floor(86400/this._intInterval.amount()),imin=0;imax>=imin;){if(imid=Math.floor((imin+imax)/2),approx2=approx.addLocal(imid*this._intInterval.amount(),basics_1.TimeUnit.Second),approxMin=approx2.subLocal(this._intInterval.amount(),basics_1.TimeUnit.Second),approx2.greaterThan(normalFrom)&&approxMin.lessEqual(normalFrom)){approx=approx2;break}approx2.lessEqual(normalFrom)?imin=imid+1:imax=imid-1}break;case basics_1.TimeUnit.Minute:this._intInterval.amount()<60&&60%this._intInterval.amount()===0?approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),normalFrom.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone()).subLocal(1,basics_1.TimeUnit.Hour):(approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone()),remainder=Math.floor(1440%this._intInterval.amount()),approx.greaterThan(normalFrom)?approx.subLocal(remainder,basics_1.TimeUnit.Minute).greaterThan(normalFrom)&&(approx=approx.subLocal(1,basics_1.TimeUnit.Day)):approx.addLocal(1,basics_1.TimeUnit.Day).subLocal(remainder,basics_1.TimeUnit.Minute).lessEqual(normalFrom)&&(approx=approx.addLocal(1,basics_1.TimeUnit.Day)));break;case basics_1.TimeUnit.Hour:approx=new datetime_1.DateTime(normalFrom.year(),normalFrom.month(),normalFrom.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone()),remainder=Math.floor(24%this._intInterval.amount()),approx.greaterThan(normalFrom)?approx.subLocal(remainder,basics_1.TimeUnit.Hour).greaterThan(normalFrom)&&(approx=approx.subLocal(1,basics_1.TimeUnit.Day)):approx.addLocal(1,basics_1.TimeUnit.Day).subLocal(remainder,basics_1.TimeUnit.Hour).lessEqual(normalFrom)&&(approx=approx.addLocal(1,basics_1.TimeUnit.Day));break;case basics_1.TimeUnit.Day:diff=normalFrom.diff(this._intReference).hours()/24,periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.addLocal(periods*this._intInterval.amount(),this._intInterval.unit());break;case basics_1.TimeUnit.Month:diff=12*(normalFrom.year()-this._intReference.year())+(normalFrom.month()-this._intReference.month()),periods=Math.floor(diff/this._intInterval.amount()),approx=this._intReference.addLocal(this._interval.multiply(periods));break;case basics_1.TimeUnit.Year:diff=normalFrom.year()-this._intReference.year()-1,periods=Math.floor(diff/this._intInterval.amount()),newYear=this._intReference.year()+periods*this._intInterval.amount(),approx=new datetime_1.DateTime(newYear,this._intReference.month(),this._intReference.day(),this._intReference.hour(),this._intReference.minute(),this._intReference.second(),this._intReference.millisecond(),this._intReference.zone());break;default:throw new Error("Unknown TimeUnit")}for(;!approx.greaterThan(normalFrom);)approx=approx.addLocal(this._intInterval.amount(),this._intInterval.unit())}return this._correctDay(approx).convert(fromDate.zone())},Period.prototype.findNext=function(prev,count){void 0===count&&(count=1),assert_1.default(!!prev,"Prev must be given"),assert_1.default(!!this._intReference.zone()==!!prev.zone(),"The fromDate and referenceDate must both be aware or unaware"),assert_1.default("number"==typeof count,"Count must be a number"),assert_1.default(Math.floor(count)===count,"Count must be an integer");var normalizedPrev=this._normalizeDay(prev.toZone(this._reference.zone()));return this._intDst===PeriodDst.RegularIntervals?this._correctDay(normalizedPrev.add(this._intInterval.amount()*count,this._intInterval.unit())).convert(prev.zone()):this._correctDay(normalizedPrev.addLocal(this._intInterval.amount()*count,this._intInterval.unit())).convert(prev.zone())},Period.prototype.findLast=function(from){var result=this.findPrev(this.findFirst(from));return result.equals(from)&&(result=this.findPrev(result)),result},Period.prototype.findPrev=function(next,count){return void 0===count&&(count=1),this.findNext(next,-1*count)},Period.prototype.isBoundary=function(occurrence){return!!occurrence&&(assert_1.default(!!this._intReference.zone()==!!occurrence.zone(),"The occurrence and referenceDate must both be aware or unaware"),this.findFirst(occurrence.sub(duration_1.Duration.milliseconds(1))).equals(occurrence))},Period.prototype.equals=function(other){return this.isBoundary(other.reference())&&this._intInterval.equalsExact(other.interval())&&this._intDst===other._intDst},Period.prototype.identical=function(other){return this._reference.identical(other.reference())&&this._interval.identical(other.interval())&&this.dst()===other.dst()},Period.prototype.toIsoString=function(){return this._reference.toIsoString()+"/"+this._interval.toIsoString()},Period.prototype.toString=function(){var result=this._interval.toString()+", referenceing at "+this._reference.toString();return this._dstRelevant()&&(result+=", keeping "+periodDstToString(this._dst)),result},Period.prototype.inspect=function(){return"[Period: "+this.toString()+"]"},Period.prototype._correctDay=function(d){return this._reference!==this._intReference?new datetime_1.DateTime(d.year(),d.month(),Math.min(basics.daysInMonth(d.year(),d.month()),this._reference.day()),d.hour(),d.minute(),d.second(),d.millisecond(),d.zone()):d},Period.prototype._normalizeDay=function(d,anymonth){return void 0===anymonth&&(anymonth=!0),this._intInterval.unit()===basics_1.TimeUnit.Month&&d.day()>28||this._intInterval.unit()===basics_1.TimeUnit.Year&&(2===d.month()||anymonth)&&d.day()>28?new datetime_1.DateTime(d.year(),d.month(),28,d.hour(),d.minute(),d.second(),d.millisecond(),d.zone()):d},Period.prototype._dstRelevant=function(){return!!this._reference.zone()&&this._reference.zone().kind()===timezone_1.TimeZoneKind.Proper&&this._reference.zone().hasDst()},Period.prototype._calcInternalValues=function(){var intAmount=this._interval.amount(),intUnit=this._interval.unit();intUnit===basics_1.TimeUnit.Millisecond&&intAmount>=1e3&&intAmount%1e3===0&&(intAmount/=1e3,intUnit=basics_1.TimeUnit.Second),intUnit===basics_1.TimeUnit.Second&&intAmount>=60&&intAmount%60===0&&(intAmount/=60,intUnit=basics_1.TimeUnit.Minute),intUnit===basics_1.TimeUnit.Minute&&intAmount>=60&&intAmount%60===0&&(intAmount/=60,intUnit=basics_1.TimeUnit.Hour),intUnit===basics_1.TimeUnit.Hour&&intAmount>=24&&intAmount%24===0&&(intAmount/=24,intUnit=basics_1.TimeUnit.Day),intUnit===basics_1.TimeUnit.Week&&(intAmount*=7,intUnit=basics_1.TimeUnit.Day),intUnit===basics_1.TimeUnit.Month&&intAmount>=12&&intAmount%12===0&&(intAmount/=12,intUnit=basics_1.TimeUnit.Year),this._intInterval=new duration_1.Duration(intAmount,intUnit),this._dstRelevant()?this._intDst=this._dst:this._intDst=PeriodDst.RegularIntervals,this._intReference=this._normalizeDay(this._reference,!1)},Period}();exports.Period=Period},{"./assert":1,"./basics":2,"./datetime":3,"./duration":4,"./timezone":13}],11:[function(require,module,exports){"use strict";function padLeft(s,width,char){for(var padding="",i=0;i<width-s.length;i++)padding+=char;return padding+s}function padRight(s,width,char){for(var padding="",i=0;i<width-s.length;i++)padding+=char;return s+padding}exports.padLeft=padLeft,exports.padRight=padRight},{}],12:[function(require,module,exports){"use strict";var RealTimeSource=function(){function RealTimeSource(){}return RealTimeSource.prototype.now=function(){return new Date},RealTimeSource}();exports.RealTimeSource=RealTimeSource},{}],13:[function(require,module,exports){"use strict";function local(){return TimeZone.local()}function utc(){return TimeZone.utc()}function zone(a,dst){return TimeZone.zone(a,dst)}var assert_1=require("./assert"),basics_1=require("./basics"),strings=require("./strings"),tz_database_1=require("./tz-database");exports.local=local,exports.utc=utc,exports.zone=zone,function(TimeZoneKind){TimeZoneKind[TimeZoneKind.Local=0]="Local",TimeZoneKind[TimeZoneKind.Offset=1]="Offset",TimeZoneKind[TimeZoneKind.Proper=2]="Proper"}(exports.TimeZoneKind||(exports.TimeZoneKind={}));var TimeZoneKind=exports.TimeZoneKind,TimeZone=function(){function TimeZone(name,dst){void 0===dst&&(dst=!0),this._name=name,this._dst=dst,"localtime"===name?this._kind=TimeZoneKind.Local:"+"===name.charAt(0)||"-"===name.charAt(0)||name.charAt(0).match(/\d/)||"Z"===name?(this._kind=TimeZoneKind.Offset,this._offset=TimeZone.stringToOffset(name)):(this._kind=TimeZoneKind.Proper,assert_1.default(tz_database_1.TzDatabase.instance().exists(name),"non-existing time zone name '"+name+"'"))}return TimeZone.local=function(){return TimeZone._findOrCreate("localtime",!0)},TimeZone.utc=function(){return TimeZone._findOrCreate("UTC",!0)},TimeZone.zone=function(a,dst){void 0===dst&&(dst=!0);var name="";switch(typeof a){case"string":var s=a;if(0===s.trim().length)return null;s.indexOf("without DST")>=0&&(dst=!1,s=s.slice(0,s.indexOf("without DST")-1)),name=TimeZone._normalizeString(s);break;case"number":var offset=a;assert_1.default(offset>-1440&&offset<1440,"TimeZone.zone(): offset out of range"),name=TimeZone.offsetToString(offset);break;default:throw new Error('TimeZone.zone(): Unexpected argument type "'+typeof a+'"')}return TimeZone._findOrCreate(name,dst)},TimeZone.prototype.clone=function(){return this},TimeZone.prototype.name=function(){return this._name},TimeZone.prototype.dst=function(){return this._dst},TimeZone.prototype.kind=function(){return this._kind},TimeZone.prototype.equals=function(other){if(this.isUtc()&&other.isUtc())return!0;switch(this._kind){case TimeZoneKind.Local:return other.kind()===TimeZoneKind.Local;case TimeZoneKind.Offset:return other.kind()===TimeZoneKind.Offset&&this._offset===other._offset;case TimeZoneKind.Proper:return other.kind()===TimeZoneKind.Proper&&this._name===other._name&&(this._dst===other._dst||!this.hasDst());default:throw new Error("Unknown time zone kind.")}},TimeZone.prototype.identical=function(other){switch(this._kind){case TimeZoneKind.Local:return other.kind()===TimeZoneKind.Local;case TimeZoneKind.Offset:return other.kind()===TimeZoneKind.Offset&&this._offset===other._offset;case TimeZoneKind.Proper:return other.kind()===TimeZoneKind.Proper&&this._name===other._name&&this._dst===other._dst;default:throw new Error("Unknown time zone kind.")}},TimeZone.prototype.isUtc=function(){switch(this._kind){case TimeZoneKind.Local:return!1;case TimeZoneKind.Offset:return 0===this._offset;case TimeZoneKind.Proper:return tz_database_1.TzDatabase.instance().zoneIsUtc(this._name);default:return!1}},TimeZone.prototype.hasDst=function(){switch(this._kind){case TimeZoneKind.Local:return!1;case TimeZoneKind.Offset:return!1;case TimeZoneKind.Proper:return tz_database_1.TzDatabase.instance().hasDst(this._name);default:return!1}},TimeZone.prototype.offsetForUtc=function(a,month,day,hour,minute,second,milli){var utcTime=a&&a instanceof basics_1.TimeStruct?a:new basics_1.TimeStruct({year:a,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli});switch(this._kind){case TimeZoneKind.Local:var date=new Date(Date.UTC(utcTime.components.year,utcTime.components.month-1,utcTime.components.day,utcTime.components.hour,utcTime.components.minute,utcTime.components.second,utcTime.components.milli));return-1*date.getTimezoneOffset();case TimeZoneKind.Offset:return this._offset;case TimeZoneKind.Proper:return this._dst?tz_database_1.TzDatabase.instance().totalOffset(this._name,utcTime).minutes():tz_database_1.TzDatabase.instance().standardOffset(this._name,utcTime).minutes();default:throw new Error("unknown TimeZoneKind '"+this._kind+"'")}},TimeZone.prototype.standardOffsetForUtc=function(a,month,day,hour,minute,second,milli){var utcTime=a&&a instanceof basics_1.TimeStruct?a:new basics_1.TimeStruct({year:a,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli});switch(this._kind){case TimeZoneKind.Local:var date=new Date(Date.UTC(utcTime.components.year,0,1,0));return-1*date.getTimezoneOffset();case TimeZoneKind.Offset:return this._offset;case TimeZoneKind.Proper:return tz_database_1.TzDatabase.instance().standardOffset(this._name,utcTime).minutes();default:throw new Error("unknown TimeZoneKind '"+this._kind+"'")}},TimeZone.prototype.offsetForZone=function(a,month,day,hour,minute,second,milli){var localTime=a&&a instanceof basics_1.TimeStruct?a:new basics_1.TimeStruct({year:a,month:month,day:day,hour:hour,minute:minute,second:second,milli:milli});switch(this._kind){case TimeZoneKind.Local:var date=new Date(localTime.components.year,localTime.components.month-1,localTime.components.day,localTime.components.hour,localTime.components.minute,localTime.components.second,localTime.components.milli);return-1*date.getTimezoneOffset();case TimeZoneKind.Offset:return this._offset;case TimeZoneKind.Proper:return this._dst?tz_database_1.TzDatabase.instance().totalOffsetLocal(this._name,localTime).minutes():tz_database_1.TzDatabase.instance().standardOffset(this._name,localTime).minutes();default:throw new Error("unknown TimeZoneKind '"+this._kind+"'")}},TimeZone.prototype.offsetForUtcDate=function(date,funcs){return this.offsetForUtc(basics_1.TimeStruct.fromDate(date,funcs))},TimeZone.prototype.offsetForZoneDate=function(date,funcs){return this.offsetForZone(basics_1.TimeStruct.fromDate(date,funcs))},TimeZone.prototype.abbreviationForUtc=function(a,b,day,hour,minute,second,milli,c){var utcTime,dstDependent=!0;switch(a instanceof basics_1.TimeStruct?(utcTime=a,dstDependent=b!==!1):(utcTime=new basics_1.TimeStruct({year:a,month:b,day:day,hour:hour,minute:minute,second:second,milli:milli}),dstDependent=c!==!1),this._kind){case TimeZoneKind.Local:return"local";case TimeZoneKind.Offset:return this.toString();case TimeZoneKind.Proper:return tz_database_1.TzDatabase.instance().abbreviation(this._name,utcTime,dstDependent);default:throw new Error("unknown TimeZoneKind '"+this._kind+"'")}},TimeZone.prototype.normalizeZoneTime=function(localTime,opt){void 0===opt&&(opt=tz_database_1.NormalizeOption.Up);var tzopt=opt===tz_database_1.NormalizeOption.Down?tz_database_1.NormalizeOption.Down:tz_database_1.NormalizeOption.Up;return this.kind()===TimeZoneKind.Proper?"number"==typeof localTime?tz_database_1.TzDatabase.instance().normalizeLocal(this._name,new basics_1.TimeStruct(localTime),tzopt).unixMillis:tz_database_1.TzDatabase.instance().normalizeLocal(this._name,localTime,tzopt):localTime},TimeZone.prototype.toString=function(){var result=this.name();return this.kind()===TimeZoneKind.Proper&&this.hasDst()&&!this.dst()&&(result+=" without DST"),result},TimeZone.prototype.inspect=function(){return"[TimeZone: "+this.toString()+"]"},TimeZone.offsetToString=function(offset){var sign=offset<0?"-":"+",hours=Math.floor(Math.abs(offset)/60),minutes=Math.floor(Math.abs(offset)%60);return sign+strings.padLeft(hours.toString(10),2,"0")+":"+strings.padLeft(minutes.toString(10),2,"0")},TimeZone.stringToOffset=function(s){var t=s.trim();if("Z"===t)return 0;assert_1.default(t.match(/^[+-]\d\d(:?)\d\d$/)||t.match(/^[+-]\d\d$/),'Wrong time zone format: "'+t+'"');var sign="+"===t.charAt(0)?1:-1,hours=parseInt(t.substr(1,2),10),minutes=0;return 5===t.length?minutes=parseInt(t.substr(3,2),10):6===t.length&&(minutes=parseInt(t.substr(4,2),10)),assert_1.default(hours>=0&&hours<24,"Offsets from UTC must be less than a day."),sign*(60*hours+minutes)},TimeZone._findOrCreate=function(name,dst){var key=name+(dst?"_DST":"_NO-DST");if(key in TimeZone._cache)return TimeZone._cache[key];var t=new TimeZone(name,dst);return TimeZone._cache[key]=t,t},TimeZone._normalizeString=function(s){var t=s.trim();return assert_1.default(t.length>0,"Empty time zone string given"),"localtime"===t?t:"Z"===t?"+00:00":TimeZone._isOffsetString(t)?TimeZone.offsetToString(TimeZone.stringToOffset(t)):t},TimeZone._isOffsetString=function(s){var t=s.trim();return"+"===t.charAt(0)||"-"===t.charAt(0)||"Z"===t},TimeZone._cache={},TimeZone}();exports.TimeZone=TimeZone},{"./assert":1,"./basics":2,"./strings":11,"./tz-database":15}],14:[function(require,module,exports){"use strict";function mapSymbolToType(symbol){return symbolMapping.hasOwnProperty(symbol)?symbolMapping[symbol]:DateTimeTokenType.IDENTITY}var Tokenizer=function(){function Tokenizer(_formatString){this._formatString=_formatString}return Tokenizer.prototype.setFormatString=function(formatString){this._formatString=formatString},Tokenizer.prototype._appendToken=function(tokenString,tokenArray,raw){if(""!==tokenString){var token={length:tokenString.length,raw:tokenString,symbol:tokenString[0],type:DateTimeTokenType.IDENTITY};raw||(token.type=mapSymbolToType(token.symbol)),tokenArray.push(token)}return tokenArray},Tokenizer.prototype.parseTokens=function(){for(var result=[],currentToken="",previousChar="",quoting=!1,possibleEscaping=!1,i=0;i<this._formatString.length;++i){var currentChar=this._formatString[i];"'"!==currentChar?(possibleEscaping&&(quoting=!quoting,possibleEscaping=!1,result=this._appendToken(currentToken,result,!quoting),currentToken=""),quoting?(currentToken+=currentChar,previousChar=currentChar):(currentChar!==previousChar?(result=this._appendToken(currentToken,result),currentToken=currentChar):currentToken+=currentChar,previousChar=currentChar)):(quoting?possibleEscaping?(currentToken+=currentChar,possibleEscaping=!1):possibleEscaping=!0:possibleEscaping?(currentChar!==previousChar&&(result=this._appendToken(currentToken,result),currentToken=""),currentToken+="'",possibleEscaping=!1):possibleEscaping=!0,possibleEscaping||(previousChar=currentChar))}return result=this._appendToken(currentToken,result,quoting)},Tokenizer}();exports.Tokenizer=Tokenizer,function(DateTimeTokenType){DateTimeTokenType[DateTimeTokenType.IDENTITY=0]="IDENTITY",DateTimeTokenType[DateTimeTokenType.ERA=1]="ERA",DateTimeTokenType[DateTimeTokenType.YEAR=2]="YEAR",DateTimeTokenType[DateTimeTokenType.QUARTER=3]="QUARTER",DateTimeTokenType[DateTimeTokenType.MONTH=4]="MONTH",DateTimeTokenType[DateTimeTokenType.WEEK=5]="WEEK",DateTimeTokenType[DateTimeTokenType.DAY=6]="DAY",DateTimeTokenType[DateTimeTokenType.WEEKDAY=7]="WEEKDAY",DateTimeTokenType[DateTimeTokenType.DAYPERIOD=8]="DAYPERIOD",DateTimeTokenType[DateTimeTokenType.HOUR=9]="HOUR",DateTimeTokenType[DateTimeTokenType.MINUTE=10]="MINUTE",DateTimeTokenType[DateTimeTokenType.SECOND=11]="SECOND",DateTimeTokenType[DateTimeTokenType.ZONE=12]="ZONE"}(exports.DateTimeTokenType||(exports.DateTimeTokenType={}));var DateTimeTokenType=exports.DateTimeTokenType,symbolMapping={G:DateTimeTokenType.ERA,y:DateTimeTokenType.YEAR,Y:DateTimeTokenType.YEAR,u:DateTimeTokenType.YEAR,U:DateTimeTokenType.YEAR,r:DateTimeTokenType.YEAR,Q:DateTimeTokenType.QUARTER,q:DateTimeTokenType.QUARTER,M:DateTimeTokenType.MONTH,L:DateTimeTokenType.MONTH,l:DateTimeTokenType.MONTH,w:DateTimeTokenType.WEEK,W:DateTimeTokenType.WEEK,d:DateTimeTokenType.DAY,D:DateTimeTokenType.DAY,F:DateTimeTokenType.DAY,g:DateTimeTokenType.DAY,E:DateTimeTokenType.WEEKDAY,e:DateTimeTokenType.WEEKDAY,c:DateTimeTokenType.WEEKDAY,a:DateTimeTokenType.DAYPERIOD,h:DateTimeTokenType.HOUR,H:DateTimeTokenType.HOUR,k:DateTimeTokenType.HOUR,K:DateTimeTokenType.HOUR,j:DateTimeTokenType.HOUR,J:DateTimeTokenType.HOUR,m:DateTimeTokenType.MINUTE,s:DateTimeTokenType.SECOND,S:DateTimeTokenType.SECOND,A:DateTimeTokenType.SECOND,z:DateTimeTokenType.ZONE,Z:DateTimeTokenType.ZONE,O:DateTimeTokenType.ZONE,v:DateTimeTokenType.ZONE,V:DateTimeTokenType.ZONE,X:DateTimeTokenType.ZONE,x:DateTimeTokenType.ZONE}},{}],15:[function(require,module,exports){(function(global){"use strict";function monthNameToString(name){for(var i=1;i<=12;++i)if(TzMonthNames[i]===name)return i;throw new Error('Invalid month name "'+name+'"')}function isValidOffsetString(s){return/^(\-|\+)?([0-9]+((\:[0-9]+)?(\:[0-9]+(\.[0-9]+)?)?))$/.test(s)}function validateData(data){var result={minDstSave:null,maxDstSave:null,minGmtOff:null,maxGmtOff:null};if("object"!=typeof data)throw new Error("data is not an object");if(!data.hasOwnProperty("rules"))throw new Error("data has no rules property");if(!data.hasOwnProperty("zones"))throw new Error("data has no zones property");for(var zoneName in data.zones)if(data.zones.hasOwnProperty(zoneName)){var zoneArr=data.zones[zoneName];if("string"==typeof zoneArr){if(!data.zones.hasOwnProperty(zoneArr))throw new Error('Entry for zone "'+zoneName+'" links to "'+zoneArr+"\" but that doesn't exist")}else{if(!Array.isArray(zoneArr))throw new Error('Entry for zone "'+zoneName+'" is neither a string nor an array');for(var i=0;i<zoneArr.length;i++){var entry=zoneArr[i];if(!Array.isArray(entry))throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" is not an array');if(4!==entry.length)throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" has length != 4');if("string"!=typeof entry[0])throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" first column is not a string');var gmtoff=math.filterFloat(entry[0]);if(isNaN(gmtoff))throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" first column does not contain a number');if("string"!=typeof entry[1])throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" second column is not a string');if("string"!=typeof entry[2])throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" third column is not a string');if("string"!=typeof entry[3]&&null!==entry[3])throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" fourth column is not a string nor null');if("string"==typeof entry[3]&&isNaN(math.filterFloat(entry[3])))throw new Error("Entry "+i.toString(10)+' for zone "'+zoneName+'" fourth column does not contain a number');(null===result.maxGmtOff||gmtoff>result.maxGmtOff)&&(result.maxGmtOff=gmtoff),(null===result.minGmtOff||gmtoff<result.minGmtOff)&&(result.minGmtOff=gmtoff)}}}for(var ruleName in data.rules)if(data.rules.hasOwnProperty(ruleName)){var ruleArr=data.rules[ruleName];if(!Array.isArray(ruleArr))throw new Error('Entry for rule "'+ruleName+'" is not an array');for(var i=0;i<ruleArr.length;i++){var rule=ruleArr[i];if(!Array.isArray(rule))throw new Error("Rule "+ruleName+"["+i.toString(10)+"] is not an array");if(rule.length<8)throw new Error("Rule "+ruleName+"["+i.toString(10)+"] is not of length 8");for(var j=0;j<rule.length;j++)if(5!==j&&"string"!=typeof rule[j])throw new Error("Rule "+ruleName+"["+i.toString(10)+"]["+j.toString(10)+"] is not a string");if("NaN"!==rule[0]&&isNaN(parseInt(rule[0],10)))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][0] is not a number");if("only"!==rule[1]&&"max"!==rule[1]&&isNaN(parseInt(rule[1],10)))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][1] is not a number, only or max");if(!TzMonthNames.hasOwnProperty(rule[3]))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][3] is not a month name");if("last"!==rule[4].substr(0,4)&&rule[4].indexOf(">=")===-1&&rule[4].indexOf("<=")===-1&&isNaN(parseInt(rule[4],10)))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][4] is not a known type of expression");if(!Array.isArray(rule[5]))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][5] is not an array");if(4!==rule[5].length)throw new Error("Rule "+ruleName+"["+i.toString(10)+"][5] is not of length 4");if(isNaN(parseInt(rule[5][0],10)))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][5][0] is not a number");if(isNaN(parseInt(rule[5][1],10)))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][5][1] is not a number");if(isNaN(parseInt(rule[5][2],10)))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][5][2] is not a number");if(""!==rule[5][3]&&"s"!==rule[5][3]&&"w"!==rule[5][3]&&"g"!==rule[5][3]&&"u"!==rule[5][3]&&"z"!==rule[5][3]&&null!==rule[5][3])throw new Error("Rule "+ruleName+"["+i.toString(10)+"][5][3] is not empty, g, z, s, w, u or null");var save=parseInt(rule[6],10);if(isNaN(save))throw new Error("Rule "+ruleName+"["+i.toString(10)+"][6] does not contain a valid number");0!==save&&((null===result.maxDstSave||save>result.maxDstSave)&&(result.maxDstSave=save),(null===result.minDstSave||save<result.minDstSave)&&(result.minDstSave=save))}}return result}var assert_1=require("./assert"),basics_1=require("./basics"),basics=require("./basics"),duration_1=require("./duration"),math=require("./math");!function(ToType){ToType[ToType.Year=0]="Year",ToType[ToType.Max=1]="Max"}(exports.ToType||(exports.ToType={}));var ToType=exports.ToType;!function(OnType){OnType[OnType.DayNum=0]="DayNum",OnType[OnType.LastX=1]="LastX",OnType[OnType.GreqX=2]="GreqX",OnType[OnType.LeqX=3]="LeqX"}(exports.OnType||(exports.OnType={}));var OnType=exports.OnType;!function(AtType){AtType[AtType.Standard=0]="Standard",AtType[AtType.Wall=1]="Wall",AtType[AtType.Utc=2]="Utc"}(exports.AtType||(exports.AtType={}));var AtType=exports.AtType,RuleInfo=function(){function RuleInfo(from,toType,toYear,type,inMonth,onType,onDay,onWeekDay,atHour,atMinute,atSecond,atType,save,letter){this.from=from,this.toType=toType,this.toYear=toYear,this.type=type,this.inMonth=inMonth,this.onType=onType,this.onDay=onDay,this.onWeekDay=onWeekDay,this.atHour=atHour,this.atMinute=atMinute,this.atSecond=atSecond,this.atType=atType,this.save=save,this.letter=letter,this.save&&(this.save=this.save.convert(basics_1.TimeUnit.Hour))}return RuleInfo.prototype.applicable=function(year){if(year<this.from)return!1;switch(this.toType){case ToType.Max:return!0;case ToType.Year:return year<=this.toYear}},RuleInfo.prototype.effectiveLess=function(other){return this.from<other.from||!(this.from>other.from)&&(this.inMonth<other.inMonth||!(this.inMonth>other.inMonth)&&this.effectiveDate(this.from)<other.effectiveDate(this.from))},RuleInfo.prototype.effectiveEqual=function(other){return this.from===other.from&&(this.inMonth===other.inMonth&&!!this.effectiveDate(this.from).equals(other.effectiveDate(this.from)))},RuleInfo.prototype.effectiveDate=function(year){assert_1.default(this.applicable(year),"Rule is not applicable in "+year.toString(10));var tm={year:year,month:this.inMonth};switch(this.onType){case OnType.DayNum:tm.day=this.onDay;break;case OnType.GreqX:tm.day=basics.weekDayOnOrAfter(year,this.inMonth,this.onDay,this.onWeekDay);break;case OnType.LeqX:tm.day=basics.weekDayOnOrBefore(year,this.inMonth,this.onDay,this.onWeekDay);break;case OnType.LastX:tm.day=basics.lastWeekDayOfMonth(year,this.inMonth,this.onWeekDay)}return tm.hour=this.atHour,tm.minute=this.atMinute,tm.second=this.atSecond,new basics_1.TimeStruct(tm)},RuleInfo.prototype.transitionTimeUtc=function(year,standardOffset,prevRule){assert_1.default(this.applicable(year),"Rule not applicable in given year");var offset,unixMillis=this.effectiveDate(year).unixMillis;switch(this.atType){case AtType.Utc:offset=duration_1.Duration.hours(0);break;case AtType.Standard:offset=standardOffset;break;case AtType.Wall:offset=prevRule?standardOffset.add(prevRule.save):standardOffset;break;default:throw new Error("unknown AtType")}return unixMillis-offset.milliseconds();
},RuleInfo}();exports.RuleInfo=RuleInfo,function(RuleType){RuleType[RuleType.None=0]="None",RuleType[RuleType.Offset=1]="Offset",RuleType[RuleType.RuleName=2]="RuleName"}(exports.RuleType||(exports.RuleType={}));var RuleType=exports.RuleType,ZoneInfo=function(){function ZoneInfo(gmtoff,ruleType,ruleOffset,ruleName,format,until){this.gmtoff=gmtoff,this.ruleType=ruleType,this.ruleOffset=ruleOffset,this.ruleName=ruleName,this.format=format,this.until=until,this.ruleOffset&&(this.ruleOffset=this.ruleOffset.convert(basics.TimeUnit.Hour))}return ZoneInfo}();exports.ZoneInfo=ZoneInfo;var TzMonthNames;!function(TzMonthNames){TzMonthNames[TzMonthNames.Jan=1]="Jan",TzMonthNames[TzMonthNames.Feb=2]="Feb",TzMonthNames[TzMonthNames.Mar=3]="Mar",TzMonthNames[TzMonthNames.Apr=4]="Apr",TzMonthNames[TzMonthNames.May=5]="May",TzMonthNames[TzMonthNames.Jun=6]="Jun",TzMonthNames[TzMonthNames.Jul=7]="Jul",TzMonthNames[TzMonthNames.Aug=8]="Aug",TzMonthNames[TzMonthNames.Sep=9]="Sep",TzMonthNames[TzMonthNames.Oct=10]="Oct",TzMonthNames[TzMonthNames.Nov=11]="Nov",TzMonthNames[TzMonthNames.Dec=12]="Dec"}(TzMonthNames||(TzMonthNames={}));var TzDayNames;!function(TzDayNames){TzDayNames[TzDayNames.Sun=0]="Sun",TzDayNames[TzDayNames.Mon=1]="Mon",TzDayNames[TzDayNames.Tue=2]="Tue",TzDayNames[TzDayNames.Wed=3]="Wed",TzDayNames[TzDayNames.Thu=4]="Thu",TzDayNames[TzDayNames.Fri=5]="Fri",TzDayNames[TzDayNames.Sat=6]="Sat"}(TzDayNames||(TzDayNames={})),exports.isValidOffsetString=isValidOffsetString;var Transition=function(){function Transition(at,offset,letter){this.at=at,this.offset=offset,this.letter=letter,this.offset&&(this.offset=this.offset.convert(basics.TimeUnit.Hour))}return Transition}();exports.Transition=Transition,function(NormalizeOption){NormalizeOption[NormalizeOption.Up=0]="Up",NormalizeOption[NormalizeOption.Down=1]="Down"}(exports.NormalizeOption||(exports.NormalizeOption={}));var NormalizeOption=exports.NormalizeOption,TzDatabase=function(){function TzDatabase(data){var _this=this;this._zoneInfoCache={},this._ruleInfoCache={},assert_1.default(!TzDatabase._instance,"You should not create an instance of the TzDatabase class yourself. Use TzDatabase.instance()"),assert_1.default(data.length>0,"Timezonecomplete needs time zone data. You need to install one of the tzdata NPM modules before using timezonecomplete."),1===data.length?this._data=data[0]:(this._data={zones:{},rules:{}},data.forEach(function(d){if(d&&d.rules&&d.zones){for(var _i=0,_a=Object.keys(d.rules);_i<_a.length;_i++){var key=_a[_i];_this._data.rules[key]=d.rules[key]}for(var _b=0,_c=Object.keys(d.zones);_b<_c.length;_b++){var key=_c[_b];_this._data.zones[key]=d.zones[key]}}})),this._minmax=validateData(this._data)}return TzDatabase.init=function(data){data?(TzDatabase._instance=void 0,TzDatabase._instance=new TzDatabase(Array.isArray(data)?data:[data])):(TzDatabase._instance=void 0,TzDatabase.instance())},TzDatabase.instance=function(){if(!TzDatabase._instance){var data_1=[],g=global?global:window;if(g)for(var _i=0,_a=Object.keys(g);_i<_a.length;_i++){var key=_a[_i];0===key.indexOf("tzdata")&&"object"==typeof g[key]&&g[key].rules&&g[key].zones&&data_1.push(g[key])}var findNodeModules=function(require){try{var tzDataName="tzdata",d=require(tzDataName);data_1.push(d)}catch(e){var moduleNames=["tzdata-africa","tzdata-antarctica","tzdata-asia","tzdata-australasia","tzdata-backward","tzdata-backward-utc","tzdata-etcetera","tzdata-europe","tzdata-northamerica","tzdata-pacificnew","tzdata-southamerica","tzdata-systemv"];moduleNames.forEach(function(moduleName){try{var d=require(moduleName);data_1.push(d)}catch(e){}})}};0===data_1.length&&"object"==typeof module&&"object"==typeof module.exports&&findNodeModules(require),TzDatabase._instance=new TzDatabase(data_1)}return TzDatabase._instance},TzDatabase.prototype.zoneNames=function(){return this._zoneNames||(this._zoneNames=Object.keys(this._data.zones),this._zoneNames.sort()),this._zoneNames},TzDatabase.prototype.exists=function(zoneName){return this._data.zones.hasOwnProperty(zoneName)},TzDatabase.prototype.minDstSave=function(zoneName){if(zoneName){for(var zoneInfos=this.getZoneInfos(zoneName),result=null,ruleNames=[],i=0;i<zoneInfos.length;++i){var zoneInfo=zoneInfos[i];if(zoneInfo.ruleType===RuleType.Offset&&(result&&!result.greaterThan(zoneInfo.ruleOffset)||0!==zoneInfo.ruleOffset.milliseconds()&&(result=zoneInfo.ruleOffset)),zoneInfo.ruleType===RuleType.RuleName&&ruleNames.indexOf(zoneInfo.ruleName)===-1){ruleNames.push(zoneInfo.ruleName);for(var temp=this.getRuleInfos(zoneInfo.ruleName),j=0;j<temp.length;++j){var ruleInfo=temp[j];result&&!result.greaterThan(ruleInfo.save)||0!==ruleInfo.save.milliseconds()&&(result=ruleInfo.save)}}}return result||(result=duration_1.Duration.hours(0)),result.clone()}return duration_1.Duration.minutes(this._minmax.minDstSave)},TzDatabase.prototype.maxDstSave=function(zoneName){if(zoneName){for(var zoneInfos=this.getZoneInfos(zoneName),result=null,ruleNames=[],i=0;i<zoneInfos.length;++i){var zoneInfo=zoneInfos[i];if(zoneInfo.ruleType===RuleType.Offset&&(result&&!result.lessThan(zoneInfo.ruleOffset)||(result=zoneInfo.ruleOffset)),zoneInfo.ruleType===RuleType.RuleName&&ruleNames.indexOf(zoneInfo.ruleName)===-1){ruleNames.push(zoneInfo.ruleName);for(var temp=this.getRuleInfos(zoneInfo.ruleName),j=0;j<temp.length;++j){var ruleInfo=temp[j];result&&!result.lessThan(ruleInfo.save)||(result=ruleInfo.save)}}}return result||(result=duration_1.Duration.hours(0)),result.clone()}return duration_1.Duration.minutes(this._minmax.maxDstSave)},TzDatabase.prototype.hasDst=function(zoneName){return 0!==this.maxDstSave(zoneName).milliseconds()},TzDatabase.prototype.nextDstChange=function(zoneName,a){for(var zoneInfo,utcTime="number"==typeof a?new basics_1.TimeStruct(a):a,allZoneInfos=this.getZoneInfos(zoneName),relevantZoneInfos=[],rangeStart=utcTime.unixMillis,rangeEnd=rangeStart+31536e6,prevEnd=null,i=0;i<allZoneInfos.length;++i)zoneInfo=allZoneInfos[i],(null===prevEnd||prevEnd<rangeEnd)&&(null===zoneInfo.until||zoneInfo.until>rangeStart)&&relevantZoneInfos.push(zoneInfo),prevEnd=zoneInfo.until;for(var transitions=[],i=0;i<relevantZoneInfos.length;++i)zoneInfo=relevantZoneInfos[i],transitions=transitions.concat(this.getTransitionsDstOffsets(zoneInfo.ruleName,utcTime.components.year-1,utcTime.components.year+1,zoneInfo.gmtoff));transitions.sort(function(a,b){return a.at-b.at});for(var prevSave=null,i=0;i<transitions.length;++i){var transition=transitions[i];if((!prevSave||!prevSave.equals(transition.offset))&&transition.at>utcTime.unixMillis)return transition.at;prevSave=transition.offset}},TzDatabase.prototype.zoneIsUtc=function(zoneName){for(var actualZoneName=zoneName,zoneEntries=this._data.zones[zoneName];"string"==typeof zoneEntries;){if(!this._data.zones.hasOwnProperty(zoneEntries))throw new Error('Zone "'+zoneEntries+'" not found (referred to in link from "'+zoneName+'" via "'+actualZoneName+'"');actualZoneName=zoneEntries,zoneEntries=this._data.zones[actualZoneName]}return"Etc/UTC"===actualZoneName||"Etc/GMT"===actualZoneName||"Etc/UCT"===actualZoneName},TzDatabase.prototype.normalizeLocal=function(zoneName,a,opt){if(void 0===opt&&(opt=NormalizeOption.Up),this.hasDst(zoneName))for(var localTime="number"==typeof a?new basics_1.TimeStruct(a):a,transitions=this.getTransitionsTotalOffsets(zoneName,localTime.components.year-1,localTime.components.year+1),prev=duration_1.Duration.hours(0),i=0;i<transitions.length;++i){var transition=transitions[i];if(transition.offset.greaterThan(prev)){var localBefore=transition.at+prev.milliseconds(),localAfter=transition.at+transition.offset.milliseconds();if(localTime.unixMillis>=localBefore&&localTime.unixMillis<localAfter){var forwardChange=transition.offset.sub(prev),factor=opt===NormalizeOption.Up?1:-1,resultMillis=localTime.unixMillis+factor*forwardChange.milliseconds();return"number"==typeof a?resultMillis:new basics_1.TimeStruct(resultMillis)}}prev=transition.offset}return"number"==typeof a?a:a.clone()},TzDatabase.prototype.standardOffset=function(zoneName,utcTime){var zoneInfo=this.getZoneInfo(zoneName,utcTime);return zoneInfo.gmtoff.clone()},TzDatabase.prototype.totalOffset=function(zoneName,utcTime){var zoneInfo=this.getZoneInfo(zoneName,utcTime),dstOffset=null;switch(zoneInfo.ruleType){case RuleType.None:dstOffset=duration_1.Duration.minutes(0);break;case RuleType.Offset:dstOffset=zoneInfo.ruleOffset;break;case RuleType.RuleName:dstOffset=this.dstOffsetForRule(zoneInfo.ruleName,utcTime,zoneInfo.gmtoff)}return dstOffset.add(zoneInfo.gmtoff)},TzDatabase.prototype.abbreviation=function(zoneName,utcTime,dstDependent){void 0===dstDependent&&(dstDependent=!0);var zoneInfo=this.getZoneInfo(zoneName,utcTime),format=zoneInfo.format;if(format.indexOf("%s")!==-1&&zoneInfo.ruleType===RuleType.RuleName){var letter=void 0;return letter=dstDependent?this.letterForRule(zoneInfo.ruleName,utcTime,zoneInfo.gmtoff):"",format.replace("%s",letter)}return format},TzDatabase.prototype.standardOffsetLocal=function(zoneName,localTime){for(var unixMillis="number"==typeof localTime?localTime:localTime.unixMillis,zoneInfos=this.getZoneInfos(zoneName),i=0;i<zoneInfos.length;++i){var zoneInfo=zoneInfos[i];if(null===zoneInfo.until||zoneInfo.until+zoneInfo.gmtoff.milliseconds()>unixMillis)return zoneInfo.gmtoff.clone()}throw new Error("No zone info found")},TzDatabase.prototype.totalOffsetLocal=function(zoneName,localTime){for(var ts="number"==typeof localTime?new basics_1.TimeStruct(localTime):localTime,normalizedTm=this.normalizeLocal(zoneName,ts),transitions=this.getTransitionsTotalOffsets(zoneName,normalizedTm.components.year-1,normalizedTm.components.year+1),prev=null,prevPrev=null,i=0;i<transitions.length;++i){var transition=transitions[i];if(transition.at+transition.offset.milliseconds()>normalizedTm.unixMillis)break;prevPrev=prev,prev=transition}if(prev){if(prevPrev&&prevPrev.offset.greaterThan(prev.offset)){var diff=prevPrev.offset.sub(prev.offset);return normalizedTm.unixMillis>=prev.at+prev.offset.milliseconds()&&normalizedTm.unixMillis<prev.at+prev.offset.milliseconds()+diff.milliseconds()?prevPrev.offset.clone():prev.offset.clone()}return prev.offset.clone()}return duration_1.Duration.hours(0)},TzDatabase.prototype.dstOffsetForRule=function(ruleName,utcTime,standardOffset){for(var ts="number"==typeof utcTime?new basics_1.TimeStruct(utcTime):utcTime,transitions=this.getTransitionsDstOffsets(ruleName,ts.components.year-1,ts.components.year,standardOffset),offset=null,i=transitions.length-1;i>=0;i--){var transition=transitions[i];if(transition.at<=ts.unixMillis){offset=transition.offset.clone();break}}return offset||(offset=duration_1.Duration.minutes(0)),offset},TzDatabase.prototype.letterForRule=function(ruleName,utcTime,standardOffset){for(var ts="number"==typeof utcTime?new basics_1.TimeStruct(utcTime):utcTime,transitions=this.getTransitionsDstOffsets(ruleName,ts.components.year-1,ts.components.year,standardOffset),letter=null,i=transitions.length-1;i>=0;i--){var transition=transitions[i];if(transition.at<=ts.unixMillis){letter=transition.letter;break}}return letter||(letter=""),letter},TzDatabase.prototype.getTransitionsDstOffsets=function(ruleName,fromYear,toYear,standardOffset){assert_1.default(fromYear<=toYear,"fromYear must be <= toYear");for(var ruleInfos=this.getRuleInfos(ruleName),result=[],y=fromYear;y<=toYear;y++)for(var prevInfo=null,i=0;i<ruleInfos.length;i++){var ruleInfo=ruleInfos[i];ruleInfo.applicable(y)&&result.push(new Transition(ruleInfo.transitionTimeUtc(y,standardOffset,prevInfo),ruleInfo.save,ruleInfo.letter)),prevInfo=ruleInfo}return result.sort(function(a,b){return a.at-b.at}),result},TzDatabase.prototype.getTransitionsTotalOffsets=function(zoneName,fromYear,toYear){assert_1.default(fromYear<=toYear,"fromYear must be <= toYear");var startMillis=basics.timeToUnixNoLeapSecs({year:fromYear}),endMillis=basics.timeToUnixNoLeapSecs({year:toYear+1}),zoneInfos=this.getZoneInfos(zoneName);assert_1.default(zoneInfos.length>0,"Empty zoneInfos array returned from getZoneInfos()");for(var prevUntilYear,result=[],prevZone=null,prevStdOffset=duration_1.Duration.hours(0),prevDstOffset=duration_1.Duration.hours(0),prevLetter="",i=0;i<zoneInfos.length;++i){var zoneInfo=zoneInfos[i],untilYear=zoneInfo.until?new basics_1.TimeStruct(zoneInfo.until).components.year:toYear+1,stdOffset=prevStdOffset,dstOffset=prevDstOffset,letter=prevLetter;if((null===prevZone||prevZone.until<endMillis-1)&&(null===zoneInfo.until||zoneInfo.until>=startMillis)){switch(stdOffset=zoneInfo.gmtoff,zoneInfo.ruleType){case RuleType.None:dstOffset=duration_1.Duration.hours(0),letter="";break;case RuleType.Offset:dstOffset=zoneInfo.ruleOffset,letter="";break;case RuleType.RuleName:if(prevZone)for(var ruleInfos=this.getRuleInfos(zoneInfo.ruleName),j=0;j<ruleInfos.length;++j){var ruleInfo=ruleInfos[j];ruleInfo.applicable(prevUntilYear)&&ruleInfo.transitionTimeUtc(prevUntilYear,stdOffset,null)===prevZone.until&&(dstOffset=ruleInfo.save,letter=ruleInfo.letter)}}var at=prevZone?prevZone.until:startMillis;if(result.push(new Transition(at,stdOffset.add(dstOffset),letter)),zoneInfo.ruleType===RuleType.RuleName)for(var dstTransitions=this.getTransitionsDstOffsets(zoneInfo.ruleName,void 0!==prevUntilYear?Math.max(prevUntilYear,fromYear):fromYear,Math.min(untilYear,toYear),stdOffset),k=0;k<dstTransitions.length;++k){var transition=dstTransitions[k];letter=transition.letter,dstOffset=transition.offset,result.push(new Transition(transition.at,transition.offset.add(stdOffset),transition.letter))}}prevZone=zoneInfo,prevUntilYear=untilYear,prevStdOffset=stdOffset,prevDstOffset=dstOffset,prevLetter=letter}return result.sort(function(a,b){return a.at-b.at}),result},TzDatabase.prototype.getZoneInfo=function(zoneName,utcTime){for(var unixMillis="number"==typeof utcTime?utcTime:utcTime.unixMillis,zoneInfos=this.getZoneInfos(zoneName),i=0;i<zoneInfos.length;++i){var zoneInfo=zoneInfos[i];if(null===zoneInfo.until||zoneInfo.until>unixMillis)return zoneInfo}throw new Error("No zone info found")},TzDatabase.prototype.getZoneInfos=function(zoneName){if(!this._data.zones.hasOwnProperty(zoneName))throw new Error('Zone "'+zoneName+'" not found.');if(this._zoneInfoCache.hasOwnProperty(zoneName))return this._zoneInfoCache[zoneName];for(var result=[],actualZoneName=zoneName,zoneEntries=this._data.zones[zoneName];"string"==typeof zoneEntries;){if(!this._data.zones.hasOwnProperty(zoneEntries))throw new Error('Zone "'+zoneEntries+'" not found (referred to in link from "'+zoneName+'" via "'+actualZoneName+'"');actualZoneName=zoneEntries,zoneEntries=this._data.zones[actualZoneName]}for(var i=0;i<zoneEntries.length;++i){var zoneEntry=zoneEntries[i],ruleType=this.parseRuleType(zoneEntry[1]),until=math.filterFloat(zoneEntry[3]);isNaN(until)&&(until=null),result.push(new ZoneInfo(duration_1.Duration.minutes(-1*math.filterFloat(zoneEntry[0])),ruleType,ruleType===RuleType.Offset?new duration_1.Duration(zoneEntry[1]):new duration_1.Duration,ruleType===RuleType.RuleName?zoneEntry[1]:"",zoneEntry[2],until))}return result.sort(function(a,b){return null===a.until&&null===b.until?0:null!==a.until&&null===b.until?-1:null===a.until&&null!==b.until?1:a.until-b.until}),this._zoneInfoCache[zoneName]=result,result},TzDatabase.prototype.getRuleInfos=function(ruleName){if(!this._data.rules.hasOwnProperty(ruleName))throw new Error('Rule set "'+ruleName+'" not found.');if(this._ruleInfoCache.hasOwnProperty(ruleName))return this._ruleInfoCache[ruleName];for(var result=[],ruleSet=this._data.rules[ruleName],i=0;i<ruleSet.length;++i){var rule=ruleSet[i],fromYear="NaN"===rule[0]?-1e4:parseInt(rule[0],10),toType=this.parseToType(rule[1]),toYear=toType===ToType.Max?0:"only"===rule[1]?fromYear:parseInt(rule[1],10),onType=this.parseOnType(rule[4]),onDay=this.parseOnDay(rule[4],onType),onWeekDay=this.parseOnWeekDay(rule[4]),monthName=rule[3],monthNumber=monthNameToString(monthName);result.push(new RuleInfo(fromYear,toType,toYear,rule[2],monthNumber,onType,onDay,onWeekDay,math.positiveModulo(parseInt(rule[5][0],10),24),math.positiveModulo(parseInt(rule[5][1],10),60),math.positiveModulo(parseInt(rule[5][2],10),60),this.parseAtType(rule[5][3]),duration_1.Duration.minutes(parseInt(rule[6],10)),"-"===rule[7]?"":rule[7]))}return result.sort(function(a,b){return a.effectiveEqual(b)?0:a.effectiveLess(b)?-1:1}),this._ruleInfoCache[ruleName]=result,result},TzDatabase.prototype.parseRuleType=function(rule){return"-"===rule?RuleType.None:isValidOffsetString(rule)?RuleType.Offset:RuleType.RuleName},TzDatabase.prototype.parseToType=function(to){if("max"===to)return ToType.Max;if("only"===to)return ToType.Year;if(isNaN(parseInt(to,10)))throw new Error("TO column incorrect: "+to);return ToType.Year},TzDatabase.prototype.parseOnType=function(on){return on.length>4&&"last"===on.substr(0,4)?OnType.LastX:on.indexOf("<=")!==-1?OnType.LeqX:on.indexOf(">=")!==-1?OnType.GreqX:OnType.DayNum},TzDatabase.prototype.parseOnDay=function(on,onType){switch(onType){case OnType.DayNum:return parseInt(on,10);case OnType.LeqX:return parseInt(on.substr(on.indexOf("<=")+2),10);case OnType.GreqX:return parseInt(on.substr(on.indexOf(">=")+2),10);default:return 0}},TzDatabase.prototype.parseOnWeekDay=function(on){for(var i=0;i<7;i++)if(on.indexOf(TzDayNames[i])!==-1)return i;return basics_1.WeekDay.Sunday},TzDatabase.prototype.parseAtType=function(at){switch(at){case"s":return AtType.Standard;case"u":return AtType.Utc;case"g":return AtType.Utc;case"z":return AtType.Utc;case"w":return AtType.Wall;case"":return AtType.Wall;case null:return AtType.Wall;default:return AtType.Wall}},TzDatabase._instance=null,TzDatabase}();exports.TzDatabase=TzDatabase}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./assert":1,"./basics":2,"./duration":4,"./math":8}],timezonecomplete:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(require("./basics")),__export(require("./datetime")),__export(require("./duration")),__export(require("./format")),__export(require("./globals")),__export(require("./javascript")),__export(require("./parse")),__export(require("./period")),__export(require("./basics")),__export(require("./timesource")),__export(require("./timezone")),__export(require("./tz-database"))},{"./basics":2,"./datetime":3,"./duration":4,"./format":5,"./globals":6,"./javascript":7,"./parse":9,"./period":10,"./timesource":12,"./timezone":13,"./tz-database":15}]},{},[])("timezonecomplete")});